function ConfigHelper(){function t(t){for(var e=0;e<globals.masterEntityConfigs.length;e++)if(globals.masterEntityConfigs[e].configName==t.configName)return void(globals.masterEntityConfigs[e]=t);globals.masterEntityConfigs.push(t),consoleApp.tabs.newMatching.masterEntityConfigs.push(t)}this.AddDynamicEntityConfigReturnId=function(e,a){dataSvc=new DataService;var n=dataSvc.CreateUpdateConfigReturnId(e,a);return a.id=n,t(a),n},this.AddOrUpdateDynamicEntityConfigReturnId=function(e,a){dataSvc=new DataService;var n=dataSvc.CreateUpdateConfigReturnId(e,a);return a.id=n,t(a),n},this.GetConfigForEntityId=function(t){var e=(new DataService).GetEntityById(t);return this.GetConfigForEntity(e)},this.GetConfigForEntity=function(t){new DataService;var e=[];globals.masterEntityConfigs.forEach(function(a){(function(t,e){if("entity"!=e.configType)return!1;var a=new JsonHelper;return null==e.matchEntity||a.Contains(e.matchEntity,t,!1)})(t,a)&&e.push(a)});var a={},n=new JsonHelper;return e.map(function(t){a=n.MergeJson(a,t,"arrayId")}),a},this.setConfigSettings=function(t){globals.currentTheme.sourceConfig=t,globals.currentTheme.backgroundImage=t.displaySettings.backgroundImage,globals.currentTheme.loadNodePopouts=t.displaySettings.loadNodePopouts,globals.currentTheme.loadRelationPopouts=t.displaySettings.loadRelationPopouts,globals.currentTheme.linkThickness=t.displaySettings.linkThickness,globals.currentTheme.entityRgbRange=t.displaySettings.entityRgbRange,globals.currentTheme.graphBackground=t.displaySettings.graphBackground,globals.currentTheme.entityLabelColor=t.displaySettings.entityLabelColor,globals.currentTheme.entityCircleTextColor=t.displaySettings.entityCircleTextColor,globals.currentTheme.opaque=t.displaySettings.opaque,globals.currentTheme.labelSizing=t.displaySettings.labelSizing,globals.currentTheme.shadow=t.displaySettings.shadow,globals.currentTheme.entityBorderColor=t.displaySettings.entityBorderColor,globals.currentTheme.glow=t.displaySettings.glow,globals.currentTheme.linkColor=t.displaySettings.linkColor,globals.currentTheme.rounded=t.displaySettings.rounded,globals.currentTheme.showLabels=t.displaySettings.showLabels,globals.currentTheme.showRelationships=t.displaySettings.showRelationships,globals.currentTheme.showRelationProperties=t.displaySettings.showRelationProperties,globals.currentTheme.haze=t.displaySettings.haze,globals.currentTheme.highlightHaze=t.displaySettings.highlightHaze,globals.currentTheme.linkMainTextColor=t.displaySettings.linkMainTextColor,globals.currentTheme.linkSubTextColor=t.displaySettings.linkSubTextColor,globals.config_ext=t},this.runStartupProcedures=function(){globals.masterConfigs.forEach(function(t){t.viewOptions.prefetchLabelSelectors&&globals.dataService.GetAllEntityTypes(t),t.startupOptions.startupSearch.forEach(function(e,a){globals.dataService.GetEntitiesByDetails(e.nodeLabel,e.properties,t)}),t.startupOptions.startupQueries.forEach(function(e,a){globals.dataService.QuerySimpleSearch(e.fromEntity,e.whereProperty,e.equalsValue,t)})})},this.getConfig=function(t){return t||globals.currentTheme.sourceConfig}}function UrlParamsTranslator(){this.Name="Paramalactic",this.Examples=["x--y","x--y.x--z","x--y.y--z"],this.ReferenceContent='\n            This format is safe to pass in your URL,\n            <br/> in the "graph" parameter.\n            <br/>Example: \n\t\t\t\t\t\t</br><span class ="inputModal code">http://www.graphex.io/?graph=x--y.y--z</span>\n\t\t\t\t\t\t<hr>\n\t\t\t\t\t\tCreate a node with any alphanumric sequence of characters:\n\t\t\t\t\t\t</br><span class ="inputModal code">MyNode1</span>\n\t\t\t\t\t\t<hr>\n\t\t\t\t\t\tLink two nodes with: <span class ="inputModal code">--</span>\n            <br/>Example:\n            </br><span class ="inputModal code">n1--n2</span>\n            <hr>\n\t\t\t\t\t\tSeparate node-pairs by using a full-stop: <span class ="inputModal code"> . </span>\n            <br/>Nodes will link to previouse nodes by name.\n            <br/>Example:\n            </br><span class ="inputModal code">n1--n2.n2--n3</span>\n            <br/>Relationships live in-beteen two dashes:\n            </br><span class ="inputModal code">node1-relationship-node2</span>\n\n\t',this.Translate=function(t){for(var e=new DataService,a=new RegExp(/(\w+-\w*-\w+)/g),n=new RegExp(/(-\w*-)/g),o=t.match(a),r=[],i=[],l=0;l<o.length;l++)for(var s=o[l],d=s.match(n),u=null,c=(s=s.replace(n,",")).split(","),p=0;p<c.length;p++){var g=c[p];if((u=i.find(t=>t.data.labels[0]===g))||(u=e.CreateEntity_AddToGraph_ReturnNode([g]),i.push(u)),p>0){var f=d[p-1].slice(1,-1),h=prevNode.data.labels[0]+"--\x3e"+u.data.labels[0];if(-1===r.indexOf(h)){r.push(h);e.CreateRelation_AddToGraph_ReturnLink(prevNode.id,u.id,null===f?[]:[f])}}prevNode=u}}}function jsonStringToObject(t){return JSON.parse(t)}function submitJsonForGraph(){var t=document.getElementById("dlg.text.json").value;(new JsonTranslator).TranslateToGraph_ReturnGraphElements("root",t),closeDialog("json2GraphDlg")}function jsonToGraph(t,e){console.log("CONVERT -string ",t);var a=processJsonToGraph("root",jsonStringToObject(t),null,0);a.nodes.map(function(t){t.temp.matchedNodes>0?t.temp.matchedNodes.forEach(function(t){t.data.properties=mergeProperties(t.data.properties,t.data.temp.properties),addDataNode(t.id,t.data,e)}):(t.properties=t.temp.properties,addDataNode(t.id,t,e))}),a.links.map(function(t){addDataLink(t.fromNodeID,t.toNodeID,t,e)})}function processJsonToGraph(t,e,a,n){console.log("CONVERT",1);var o=!a;o||a.temp.parentNodeData||(o=!0);var r=a?a.id:"root";n++;var i=getType(e),l={nodes:[],links:[]},s=!1,d=new nodeDataType;if(d.labels=[t],d.id="newnode_"+ ++globals.processUniqueId,d.temp={},d.temp.stillRoot=o,d.temp.matchedNodes=[],d.temp.parentNodeData=a,d.temp.properties=[],nodesListData=[],"object"==i){var u=[];for(var c in e)if("$matchon"==c){var p=[],g=!1;e.$matchon.forEach(function(t){"$onpath"==t?g=!0:p.push(new propertyType(t,e[t]))});var f=globals.nodeList;1==g&&(f=getNodesByMatchingLabels(o?globals.nodeList:a.toNodes,d.labels)),d.temp.matchedNodes=getNodesByMatchingProperties(f,p),d.temp.matchedNodes.map(function(t){t.data.temp={},t.data.temp.matchedNodes=[t],t.data.temp.properties=[],t.data.temp.parentNodeData=a,nodesListData.push(t.data)})}else"$rel"==c?e[c].forEach(function(t){var e=new linkDataType(r,newNode.id,++globals.processUniqueId,t.$name);e.properties=[];for(var a in t)e.properties.push(new propertyType(a,t[a]));l.links.push(e),s=!0}):u.push(c);return 0==nodesListData.length&&(nodesListData=[d]),nodesListData.forEach(function(t){if(u.forEach(function(a){var o=processJsonToGraph(a,e[a],t,n);o&&(o.nodes.map(function(t){l.nodes.push(t)}),o.links.map(function(t){l.links.push(t)}))}),a&&l.nodes.push(t),!s&&a&&a.temp.parentNodeData){var o=new linkDataType(r,t.id,"newlink_"+ ++globals.processUniqueId,"DEFAULT");l.links.push(o)}}),l}if("array"==i)return e.forEach(function(t){var e;(e=processJsonToGraph(d.labels[0],t,a,n))&&(e.nodes.map(function(t){l.nodes.push(t)}),e.links.map(function(t){l.links.push(t)}))}),l;if(a){a.temp.properties.push(new propertyType(t,e));return l}}function createJsonFromSelectedNodes(){var t=[],e=[];globals.checkedNodes.forEach(function(a){if(-1==e.map(function(t){return t.id}).indexOf(a.id)){e.push(a);var n=!0;a.data.fromNodes.forEach(function(t){globals.checkedNodes.map(function(t){return t.id}).indexOf(a.id)>-1&&(n=!1)}),n&&t.push(a)}}),0==t.length&&0!=globals.checkedNodes.length&&t.push(globals.checkedNodes[0]);var a={};e=[];var n=[];t.map(function(t,e){-1==n.indexOf(t.data.labels[0])&&n.push(t.data.labels[0])}),n.forEach(function(n){var o=!1,r=0;t.map(function(t){t.data.labels[0]==n&&r++}),r>1&&(o=!0),o&&(a[n]=[]),t.forEach(function(t){t.data.labels[0]==n&&(o?a[n].push(createJsonFromNode(t,{},e)):a[n]=createJsonFromNode(t,{},e))})});var o=JSON.stringify(a),r=document.getElementById("myDialog");document.getElementById("myDialogText").innerHTML=o,r.showModal()}function createJsonFromNode(t,e,a,n){var o=t.data.labels[0],r={};e[o]=r,r.$type=o,a.push(t);var i=[];n&&t.data.fromLinks.forEach(function(t){t.fromId==n.id&&(relationship={},relationship.$name=t.data.name,t.data.properties.forEach(function(t){relationship[t.key]=t.value}),i.push(relationship))}),i.length>0&&(r.$rel=i),t.data.properties.forEach(function(t){r[t.key]=t.value});var l=[];return t.data.toNodes.map(function(t,e){-1==l.indexOf(t.data.labels[0])&&l.push(t.data.labels[0])}),l.forEach(function(e){var n=!1,o=0;t.data.toNodes.map(function(t){t.data.labels[0]==e&&o++}),o>1&&(n=!0),n&&(r[e]=[]),t.data.toNodes.forEach(function(i){i.data.labels[0]==e&&o>0&&-1==a.indexOf(i.id)&&globals.checkedNodes.map(function(t){return t.id}).indexOf(i.id)>-1&&(n?r[e].push(createJsonFromNode(i,{},a,t)):r[e]=createJsonFromNode(i,{},a,t))})}),r}function JsonTranslator(){function t(t,a){for(var o=0;o<a.length;o++)n(a[o])?e(t,a):r(a[o])&&e(a[o],{})}function e(t,l){var s=new Entity;s.labels=[t],s.properties={};var d=[];for(var u in l){if(r(l[u])&&(s.properties[u]=l[u]),n(l[u])){p=e(u,l[u]);d.push(a("",[],s,p))}if(o(l[u]))for(var c=0;c<l[u].length;c++){if(n(l[u][c])){p=e(u,l[u][c]);d.push(a("",[],s,p))}if(r(l[u][c])){var p=e(u,l[u][c]);d.push(a("",[],s,p))}}}return s.links=d,i.push(s),s}function a(t,e,a,n){var o=new Relationship;return o.labels=[t],o.properties=e,o.fromEntity=a,o.toEntity=n,l.push(o),o}function n(t){return"object"==getType(t)}function o(t){return"array"==getType(t)}function r(t){return"object"!=getType(t)&&"array"!=getType(t)}var i=[],l=[];new JsonHelper;this.Name="Json-son",this.Examples=['{"x":{"y":{}}}','{"Sam":{"Bob":{"John":{}}}}'],this.ImportExamples=[{name:"This day in history",params:["$day","$month","$year"],value:"http://en.wikipedia.org/api/rest_v1/feed/featured/$year/$month/$day"}],this.ReferenceContent='\n\t\t\t\t\t\tObjects are nodes, eg. <span class ="inputModal code">{"John":{}}</span>\n\t\t\t\t\t\t<hr>\n\t\t\t\t\t\tNodes start from the properties of the root node.\n\t\t\t\t\t\tThe root node is never materialized.\n\t\t\t\t\t\t<hr>\n\t\t\t\t\t\tArrays will become nodes by the name of the parent property.\n\t',this.Translate=function(t,e){(new JsonTranslator).TranslateToGraph_ReturnGraphElements(e||"root",t)},this.TranslateToGraph_ReturnGraphElements=function(a,s){var d=JSON.parse(s);n(d)&&function(t){for(var e in t)if(r(t[e]))return!0;return!1}(d)?e(a,d):n(d)?function(a){for(var r in a)n(a[r])?e(r,a[r]):o(a[r])&&t(r,a[r])}(d):o(d)?t(a,d):r(d)&&e(s,{});for(var u=new DataService,c=0;c<i.length;c++){var p=u.CreateEntity_AddToGraph_ReturnNode(i[c].labels,i[c].properties);i[c].id=p.id}for(var g=[],c=0;c<l.length;c++){var f=u.CreateRelation_AddToGraph_ReturnLink(l[c].fromEntity.id,l[c].toEntity.id,l[c].labels,l[c].properties),h=new GraphElement;h.fromNode=globals.GRAPH.getNode(f.fromId),h.toNode=globals.GRAPH.getNode(f.toId),h.link=f,g.push(h)}return g}}function createNode(){var t=document.getElementById("newNodeData").value;globals.dataService.CreateEntity_AddToGraph_ReturnNode([t])}function getEntityNode(){var t=document.getElementById("nodeLabel").value;globals.dataService.GetEntitiesByType(t)}function GetRelatedEntityGraph(){globals.dataService.GetRelatedEntityGraph(globals.selectedNodeID)}function deleteLink(){globals.selectedLink&&globals.dataService.DeleteRelationship(globals.selectedLink.data.id)}function submitNewEntity(){var t=document.getElementById("new.entity.name").value;if(t&&""!=t){for(var e=document.getElementById("new.entity.property.key."+n),a=[],n=0;e;){var o=document.getElementById("new.entity.property.type."+n),r=document.getElementById("new.entity.property.value."+n);if(!r||""==r.value)return void alert("Save failed!\nInvalid property name.");var i=e.value,l=parseDataType(r.value,o.value);a.push(new propertyType(i,l)),n++,e=document.getElementById("new.entity.property.key."+n)}globals.dataService.CreateEntityReturnCallbackWithIds(t,a)}else alert("Save failed!\nNo entity name specified.")}function submitCreateRelation(t,e,a,n){var o=globals.GRAPH.getNode(t),r=globals.GRAPH.getNode(e);if(o.data.sourceConfig.prefix==r.data.sourceConfig.prefix){var i=document.getElementById("new.relation.name").value;if(i&&""!=i){for(var l=0,s=document.getElementById("new.relation.property.key."+l),d="";s;){var u=document.getElementById("new.relation.property.value."+l);if(!u||""==u.value)return void alert("Save failed!\nInvalid property name.");""!=d&&(d+=","),d+=s.value+":"+parseDataType(u.value),l++,s=document.getElementById("new.relation.property.key."+l)}""!=d&&(d="{"+d+"}"),globals.dataService.CreateRelation_AddToGraph_ReturnLink(t,e,[i],d,n,a)}else alert("Save failed!\nNo relation name specified.")}else alert("Save failed!\nYou cannot relate nodes from different sources.")}function submitUpdateEntity(){nodeID||(nodeID=globals.selectedNodeID);var t=globals.GRAPH.getNode(nodeID),e=(t.data.sourceConfig,document.getElementById("new.entity.name").value);if(e&&""!=e){for(var a=0,n="",o=document.getElementById("new.entity.property.key."+a);o;){var r=document.getElementById("new.entity.property.value."+a),i=document.getElementById("new.entity.property.type."+a);""!=n&&(n+=","),r&&"null"!=r.value?n+=" n."+o.value+"="+parseDataType(r.value,i.value):n+=" n."+o.value+"=null",a++,o=document.getElementById("new.entity.property.key."+a)}""!=n&&(n=" SET "+n);globals.dataService.UpdateEntity(nodeID,n,function(){UiShow_EditEntity(t)})}else alert("Save failed!\nNo entity name specified.")}function relateSelectedToNode(){globals.bRelate=!0}function planRelateSelectedToNode(){globals.bPlanRelate=!0}function fontGrow(){if(globals.selectedNode.data.UI.displayTextUI){var t=Number(globals.selectedNode.data.UI.displayTextUI.attr("font-size"));globals.selectedNode.data.UI.displayTextUI.attr("font-size",t+1)}}function fontShrink(){if(globals.selectedNode.data.UI.displayTextUI){var t=Number(globals.selectedNode.data.UI.displayTextUI.attr("font-size"));globals.selectedNode.data.UI.displayTextUI.attr("font-size",t-1)}}function fontDown(){if(globals.selectedNode.data.UI.displayTextUI){var t=Number(globals.selectedNode.data.UI.displayTextUI.attr("y"));globals.selectedNode.data.UI.displayTextUI.attr("y",t+1)}}function fontUp(){if(globals.selectedNode.data.UI.displayTextUI){var t=Number(globals.selectedNode.data.UI.displayTextUI.attr("y"));globals.selectedNode.data.UI.displayTextUI.attr("y",t-1)}}function updateViewOptions(){globals.viewOptions.highlightRelated=document.getElementById("vo.hr").checked,globals.viewOptions.highlightAncestors=document.getElementById("vo.ha").checked,globals.viewOptions.highlightdescendants=document.getElementById("vo.hd").checked}function updateDragOptions(){document.getElementById("do.flat").checked&&(globals.viewOptions.screenDragType="flat"),document.getElementById("do.depth").checked&&(globals.viewOptions.screenDragType="depth")}function updateViewOptions_Nav(t){globals.viewOptions.navigateDirection=t}function updateInteractionOptions(){globals.interactionOptions.checkNodes=document.getElementById("vo.ch").checked}function unPinSelectedNode(){unPinNode(globals.selectedNode)}function ButtonSimpleSearch(){var t=document.getElementById("qbuilder.from.entity").value,e=t.substring(t.length-3),a=t.substring(0,t.length-3),n=document.getElementById("qbuilder.from.property").value,o=document.getElementById("qbuilder.from.value").value;globals.dataService.QuerySimpleSearch(a,n,o,getConfigByPrefix(e))}function panelAddKeyValue(t,e,a,n,o){a||(a=""),n||(n=""),o||(o="string");var r=document.getElementById(t);console.log(e);for(var i,l=function(t,a,n,o,r){return r+="<tr><td><input id='"+e+".property.key."+t+"' class='dynamic' value='"+a+"'></input></td><td><input id='"+e+".property.value."+t+"' class='dynamic2' value='"+n+"'></input></td><td><button id=\""+e+".property.type."+t+'" value="'+o+'" class="paneloption mytooltip" onclick="panelCyclePropertyType(\''+e+".property.type."+t+"')\" >"+function(t){switch(t){case"string":i="a";break;case"number":i="1";break;case"array":i="[]";break;case"other":i="/"}return i}(o)+"</button></td></tr>"},s=0,d="",u=0;u<r.children[0].children.length;u++){var c=document.getElementById(e+".property.value."+u).value;d=l(u,document.getElementById(e+".property.key."+u).value,c,document.getElementById(e+".property.type."+u).value,d),s=u+1}d=l(s,a,n,o,d),r.children[0].innerHTML=d}function panelCyclePropertyType(t){var e=document.getElementById(t);"string"==e.value?(e.innerHTML="1",e.value="number"):"number"==e.value?(e.innerHTML="[]",e.value="array"):"array"==e.value?(e.innerHTML="/",e.value="other"):"other"==e.value&&(e.innerHTML="a",e.value="string")}function panelRemoveKeyValue(t){var e=document.getElementById(t);0!=e.children[0].children.length&&e.children[0].children[e.children[0].children.length-1].remove()}function removeLastElement(){globals.selectedNodeUI.children[globals.selectedNodeUI.children.length-1];globals.selectedNode.data.UI.focusUI.remove()}function toggleToolPanel(t){var e;globals.currentTheme.sourceConfig.viewOptions.panels.map(function(a){a.name==t&&(e=a)}),$elButton=document.getElementById("toolbar."+e.name),$elPanel=document.getElementById(e.name),$parentContainer=document.getElementById(e.parent),$hiddenParent=document.getElementById("noColumn"),$parentContainer&&$elPanel&&$elButton&&($elButton.classList.contains("showicon")?($elButton.classList.remove("showicon"),$elPanel.classList.remove("slide-out"),$elPanel.classList.add("slide-in"),globals.timeoutElements.push(new timeoutElementType({panel:$elPanel,button:$elButton},1,hideToolPanel))):($parentContainer.appendChild($elPanel),$elButton.classList.add("showicon"),$elPanel.classList.remove("slide-in"),$elPanel.classList.add("slide-out")))}function hideToolPanel(t){$topBarElem=t.button,$panel=t.panel,$topBarElem.classList.contains("showicon")||$hiddenParent.appendChild($elPanel)}function handleDragOver(t){return t.preventDefault&&t.preventDefault(),t.dataTransfer.dropEffect="move",!1}function handleDragStart(t){this.style.opacity="0.4"}function handleDragLeave(t){this.classList.remove("over")}function handleDragEnter(t){this.classList.add("over")}function handleDrop(t){return t.stopPropagation&&t.stopPropagation(),!1}function handleDragEnd(t){this.style.opacity="0.9",globals.toolPanels.forEach(function(t){t.classList.remove("over")})}function closeDialog(t){document.getElementById(t).close()}function applyConfigUpdates(t){globals.graphContainer=document.getElementById("graphContainer"),globals.graphContainer.style.background=t.displaySettings.graphBackground,null!=t.displaySettings.backgroundImage&&(globals.graphContainer.style["background-image"]="url("+t.displaySettings.backgroundImage+")")}function addValueToList(t,e,a,n){for(var o=document.getElementById(t),r=0;r<o.children.length;r++)if(o.children[r].children[0].children[2].innerHTML==n)return;var i="<tr>";i+="<td>"+e+"</td>",i+="<td>"+a+"</td>",i+="<td>"+n+"</td>",i+="</tr>",o.innerHTML+=i}function hasProperty(t,e){var a=!1;if(t)return t.forEach(function(t,n){if(t.key==e)return a=!0,!0}),a}function hasPropertyWithValue(t,e,a){var n=!1;if(t)return t.forEach(function(t,o){if(t.key==e)return n=a==t.value,a==t.value}),n}function getNodePropertyValue(t,e){var a;if(t)return t.forEach(function(t,n){if(t.key.toLowerCase()===e.toLowerCase())return a=t.value}),a}function mergeProperties(t,e){var a=[],n=[];return e.forEach(function(e){var o=!1;t.forEach(function(t){t.key==e.key&&(o=!0,t.value!=e.value&&(t.value=e.value,a.push(t)))}),o||(t.push(e),n.push(e),baseprop.push(e))}),t}function propertyListToSvgList(t,e,a){var n="";return t.forEach(function(t){n+=e+t.key+": "+t.value+a}),n}function getUpdatedProperties(t,e){var a=[];return t.forEach(function(t){var n=!1;e.forEach(function(e){t.key==e.key&&(n=!0,t.value!=e.value&&a.push({property:e,updateType:"update"}))}),n||a.push({property:t,updateType:"delete"})}),e.forEach(function(e){var n=!1;t.forEach(function(t){t.key==e.key&&(n=!0)}),n||a.push({property:e,updateType:"create"})}),a}function createChildNode(t,e,a,n,o){globals.dataService.CreateEntityReturnCallbackWithIds(e,a,function(e){for(var a=0;a<e.length;a++)globals.GRAPH.getNode(e[a]),globals.dataService.CreateRelation_AddToGraph_ReturnLink(t,e[a],[n],o)})}function calculateDistance(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function parseDataType(t,e){if(e)switch(e){case"string":return'"'+t+'"';case"number":if(!isNaN(parseFloat(t))&&isFinite(t))return Number(t);break;case"other":if("true"==t)return!0;if("false"==t)return!1;break;case"array":return"["+t.split(",").map(function(t){return'"'+t+'"'}).join()+"]"}if("true"==t)return!0;if("false"==t)return!1;if("null"==t)return null;if("undefined"!=t)return!isNaN(parseFloat(t))&&isFinite(t)?Number(t):'"'+t+'"'}function getRandomArbitrary(t,e){return Math.random()*(e-t)+t}function rgb2hex(t,e,a){return"#"+(16777216+(a|e<<8|t<<16)).toString(16).slice(1)}function sleepFor(t){for(var e=(new Date).getTime();(new Date).getTime()<e+t;);}function getType(t){return Array.isArray(t)?"array":"string"==typeof t?"string":null!=t&&"object"==typeof t?"object":null!=t&&"number"==typeof t?"number":"other"}function unPinAllNodes(){globals.nodeList.forEach(function(t){globals.layout.pinNode(t,!1),t.data.isPinned=!1})}function uncheckAll(){globals.nodeList.forEach(function(t){uncheckNode(t)}),globals.linkList.forEach(function(t){uncheckLink(t)})}function checkAll(){globals.nodeList.forEach(function(t){checkNode(t)}),globals.linkList.forEach(function(t){checkLink(t)})}function setScreenDragType(t){globals.viewOptions.screenDragType=t}function getDataRootNodes(){var t=[];return globals.nodeList.forEach(function(e){0==e.data.fromNodes.length&&t.push(e)}),t}function arrangeBy(t,e,a,n,o,r){if(t){o++,e.push(t.id);var i=globals.layout.getNodePosition(t.id).x-100*t.data.toNodes.length/2;t.data.toNodes.forEach(function(t,l){var s=globals.layout.getNodePosition(t.id);s.x=i+100*l,s.x+100>=a&&(a=s.x+100),s.x<=n&&(n-=100,a+=100);var d=r+150*o;d>s.y&&(s.y=d),globals.layout.setNodePosition(t.id,s.x,s.y),e.indexOf(t.id)<0&&arrangeBy(t,e,a,n,o,r)})}else{squares=[];var l=globals.layout.getNodePosition(globals.nodeList[0].id),s=getDataRootNodes();e=[];var d=l.x;globals.nodeList.forEach(function(t){globals.layout.pinNode(t,!0),t.data.isPinned=!0,d+=100,globals.layout.setNodePosition(t.id,d,l.y)}),a=l.x,n=l.x,r=l.y,s.forEach(function(t,o){a=arrangeBy(t,e,a,n,0,r)})}return a}function arrangeBy2(t,e,a,n,o){if(t){o++,e.push(t.id);a+=200;var r=n-100;t.data.toNodes.forEach(function(t,i){e.indexOf(t.id)<0&&(r+=100,globals.layout.setNodePosition(t.id,a,r),n=arrangeBy2(t,e,a,r,o))})}else{squares=[];var i=globals.layout.getNodePosition(globals.nodeList[0].id),l=getDataRootNodes();e=[],globals.nodeList.forEach(function(t){globals.layout.pinNode(t,!0),t.data.isPinned=!0,globals.layout.setNodePosition(t.id,i.x,i.y)}),a=i.x,n=i.y;var s=i.y;l.forEach(function(t,o){n=arrangeBy2(t,e,a,n+=100,0);var r=s+(n-s)/2;globals.layout.setNodePosition(t.id,a,r),s=n})}return n}function addNodeToGraph(t,e){var a=globals.GRAPH.getNode(t);return a=globals.GRAPH.addNode(t,e),fixTextWidth4Node(a),a}function highlightLabel(t){var e=globals.labelsList[t];globals.nodeList.forEach(function(t){t.data.UI.fullUI.attr("fill-opacity",t.data.sourceConfig.displaySettings.entityOpacity),t.data.UI.bodyUI.attr("fill-opacity",t.data.sourceConfig.displaySettings.entityOpacity),e&&-1==t.data.labels.indexOf(e.name)&&(t.data.UI.fullUI.attr("fill-opacity",t.data.sourceConfig.displaySettings.entityOpacity/5),t.data.UI.bodyUI.attr("fill-opacity",t.data.sourceConfig.displaySettings.entityOpacity/5))})}function addPlannedLink(t,e,a,n){var o=new linkDataType;o.fromNode=t,o.toNode=e,o.id=t+"_"+e+" "+a,o.name=a,o.displayLabel=a,o.linkType="planned",o.color="red",link=globals.GRAPH.addLink(t,e,o),globals.linkList.push(link)}function addDataLink(t,e,a,n){a.sourceConfig=n||globals.currentTheme.sourceConfig;var o,r=!1,i=getDataLink(a.id);if(console.log("existingLink",i),i){var l=getUpdatedProperties(a.properties,i.data.properties);(a.name!=i.data.name||l.length>0)&&(i.data.name=a.name,i.data.displayLabel=a.name,i.data.properties=a.properties,globals.animUpdateLinks.push(i)),o=i,t=i.data.fromNodeID,e=i.data.toNodeID}else r=!0,(o=globals.GRAPH.addLink(t,e,a)).data.fromNodeID=t,o.data.toNodeID=e,o.data.displayLabel=a.name,globals.linkList.push(o),fixLinkIndexes(t,e);var s=globals.GRAPH.getNode(e),d=globals.GRAPH.getNode(t);return globals.config_ext.startupOptions.linkDisplayValues.map(function(t){var e=!0;if(e=!!t.labelFrom&&(t.labelFrom==d.data.labels[0]&&e),e=!!t.labelTo&&(t.labelTo==s.data.labels[0]&&e),e=!!t.type&&(t.type==o.data.name&&e)){o.data.config=t,o.data.displayLabel=t.displayField;var a=getNodePropertyValue(o.data.properties,t.displayField);o.data.displayLabel=a||" "}}),refreshLinkVisual(o),r&&(s.data.fromLinks.push(o),s.data.fromNodes.push(d),d.data.toLinks.push(o),d.data.toNodes.push(s)),fixTextWidth4Link(o),o}function fixLinkIndexes(t,e){var a=0,n=0,o=0;globals.linkList.forEach(function(r){r.toId==e&&r.fromId==t?(a++,n++):r.toId==t&&r.fromId==e&&(a++,o++)}),globals.linkList.forEach(function(r){r.toId==e&&r.fromId==t?1==a?r.data.UI.fullUI.attr("linkPos",0):r.data.UI.fullUI.attr("linkPos",n--):r.toId==t&&r.fromId==e&&(1==a?r.data.UI.fullUI.attr("linkPos",0):r.data.UI.fullUI.attr("linkPos",o--))})}function addDataNode(t,e,a){a||(a=globals.config_ext);var n=new ConfigHelper;e.sourceConfig=n.getConfig(a);var o=getDataNode(t);if(o){var r=[];globals.graphics.getNodeUI(t),e.labels.forEach(function(t){for(var a=!1,n=0;n<e.labels.length;n++)if(e.labels[n]==t){a=!0;break}a||r.push(t)});var i=getUpdatedProperties(o.data.properties,e.properties);if(!(r.length>0||i.length>0))return;e.UI.displayTextUI&&(e.UI.displayTextUI.innerHTML=propertyListToSvgList(e.properties,'<tspan x="50" dy="1.2em">',"</tspan>")),o.data.labels=e.labels,o.data.properties=e.properties,globals.animUpdateNodes.push(o)}else!0,globals.graphics.getNodeUI(t);a.startupOptions.nodeDisplayBody.map(function(t){t.nodeLabel==e.labels[0]&&(e.config.nodeDisplayBody=t)}),a.startupOptions.nodeDisplayValues.map(function(t){t.nodeLabel==e.labels[0]&&(e.config.nodeDisplayValues=t)}),a.startupOptions.nodeStatReachers.map(function(t){t.nodeLabel==e.labels[0]&&e.config.nodeStatReachers.push(t)}),a.startupOptions.nodeTransformers.map(function(t){t.nodeLabel==e.labels[0]&&e.config.nodeTransformers.push(t)}),a.startupOptions.nodeFlyout.map(function(t){t.nodeLabel==e.labels[0]&&e.config.nodeFlyout.push(t)});var l=evaluateAugmentsAndUpdateNodeDisplay(e.sourceConfig,e);for(var s in l)e.config.nodeDisplayBody[s]=l[s];thisNodeData=e,thisIsNewNode=newNode,this_sourceConfig=a,thisNodeData.config.nodeDisplayBody.size&&(thisNodeData.nodeSize=thisNodeData.config.nodeDisplayBody.size);var d="";thisNodeData.labels.forEach(function(t,e){d&&(d+=", "+d),d||(d=""),""==d&&(d=t)}),thisNodeData.displayLabel="";var u=thisNodeData.entityConfig.config.attributes.labelText.displayData;if(u){if("property"===u.key)thisNodeData.displayLabel=getNodePropertyValue(thisNodeData.properties,u.value);else if("static"===u.key)thisNodeData.displayLabel=u.value;else if("first"===u.key)for(var c=0;c<u.value.length;c++){var p=getNodePropertyValue(thisNodeData.properties,u.value[c]);if(p){thisNodeData.displayLabel=p;break}}}else thisNodeData.displayLabel=d;if(thisNodeData.displayLabel&&""!=thisNodeData.displayLabel||(thisNodeData.displayLabel=" "),thisNodeData.config.nodeDisplayValues.circleText){""!=thisNodeData.circleText&&thisNodeData.circleText;var g=getNodePropertyValue(thisNodeData.properties,thisNodeData.config.nodeDisplayValues.displayField);thisNodeData.circleText+=g||" "}else thisNodeData.circleText=d;var f=getNeoLabel(thisNodeData.labels[0],this_sourceConfig.prefix);if(f&&(thisNodeData.entityConfig.config.attributes["background-color"]||(thisNodeData.entityConfig.config.attributes["background-color"]=f.color),thisNodeData.nodeColorRGB=f.colorRGB,thisNodeData.nodeColor=rgb2hex(thisNodeData.nodeColorRGB.r,thisNodeData.nodeColorRGB.g,thisNodeData.nodeColorRGB.b),!thisNodeData.entityConfig.config.attributes["border-color"])){var h={r:thisNodeData.nodeColorRGB.r-50,g:thisNodeData.nodeColorRGB.g-50,b:thisNodeData.nodeColorRGB.b-50},y=rgb2hex(h.r,h.g,h.b);thisNodeData.entityConfig.config.attributes["border-color"]=y,thisNodeData.nodeBorderColor=y}if(thisIsNewNode)return PerformNodeStatFunctions(o=addNodeToGraph(thisNodeData.id,thisNodeData)),(new GraphHelper).AddToEntityTypeDefs(o),globals.nodeList.push(o),o}function addEntityLabel(t,e,a){var n=getNeoLabel(t);if(n){e&&(n.instanceCount+=e);var o=document.getElementById("labelSelector.fetcher."+t);return o&&(o.innerHTML=n.instanceCount),n}var r=a.config.attributes.rgbRange,i={r:Math.ceil(getRandomArbitrary(r.min,r.max)),g:Math.ceil(getRandomArbitrary(r.min,r.max)),b:Math.ceil(getRandomArbitrary(r.min,r.max))},l=rgb2hex(i.r,i.g,i.b),s=new neoLabelType(t,l,i,a);return e&&(s.instanceCount+=e),globals.labelsList.push(s),s}function refreshEntitySelectors(){globals.labelsList.sort(sort_by("name",!1,function(t){if(t)return t.toUpperCase()}));var t=document.getElementById("qbuilder.from.entity"),e="gray",a="globals.dataService.GetEntitiesByType(false, '')",n='<table><tr><td><div onclick="highlightLabel()" class="labelSelectorItem" style="background-color:'+e+';">All</div></td><td>'+('<div id="labelSelector.fetcher.All" class="forlabelselector mytooltip" onclick="'+a+'"><div class="mytooltiptext ttleft ttlower">Fetch from database</div></div>')+"</td></tr>";t&&(t.innerHTML='<option value=""></option>'),globals.labelsList.forEach(function(o,r){e=o.data.sourceConfig.config.attributes.selector["background-color"],a="globals.dataService.GetEntitiesByType('"+o.name+"', '')",n+='\n\t\t\t<tr>\n\t\t\t\t<td>\n\t\t\t\t\t<div onclick="highlightLabel('+r+')" class="labelSelectorItem" style="background-color:'+e+';" > '+o.name+'\n\t\t\t\t\t</div>\n\t\t\t\t</td>\n\t\t\t\t<td>\n\t\t\t\t\t<div id="labelSelector.fetcher.'+o.name+'" class="forlabelselector mytooltip pull-right" style="background-color:'+o.color+'" onclick= "'+a+'" > '+o.instanceCount+'\n\t\t\t\t\t\t<div class="mytooltiptext ttleft ttupper">\n\t\t\t\t\t\t\tFetch from database\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</td>\n\t\t\t</tr>',t&&(t.innerHTML+='<option value="'+o.name+'">'+o.name+"</option>")}),n+="</table>";var o=document.getElementById("selectorLabels");o&&(o.innerHTML=n)}function removeNodeFromStage(t){t||(t=globals.selectedNodeID);var e=globals.GRAPH.getNode(t);e.data.toLinks.concat(e.data.fromLinks).forEach(function(t){removeLinkFromStage(t.id)});globals.nodeList.concat(e.data.toNodes.concat(e.data.fromNodes));for(a=-1;++a<globals.nodeList.length;)globals.nodeList[a].id==t&&globals.nodeList.splice(a,1);for(a=-1;++a<globals.monitoredNodes.length;)globals.monitoredNodes[a].id==t&&globals.monitoredNodes.splice(a,1);for(var a=-1;++a<globals.checkedNodes.length;)globals.checkedNodes[a].id==t&&globals.checkedNodes.splice(a,1);globals.nodeList.forEach(function(e){for(a=-1;++a<e.data.toNodes.length;)e.data.toNodes[a].id==t&&e.data.toNodes.splice(a,1);for(a=-1;++a<e.data.fromNodes.length;)e.data.fromNodes[a].id==t&&e.data.fromNodes.splice(a,1);for(a=-1;++a<e.data.toLinks.length;)e.data.toLinks[a].toNodeID==t&&e.data.toLinks.splice(a,1);for(var a=-1;++a<e.data.fromLinks.length;)e.data.fromLinks[a].fromNodeID==t&&e.data.fromLinks.splice(a,1)}),globals.GRAPH.removeNode(t),globals.consoleService.hideNodeFlyout()}function removeLinkFromStage(t){t||(t=globals.selectedLink.data.id);for(var e=getLinkById(t),a=-1;++a<globals.linkList.length;)globals.linkList[a].id==t&&globals.linkList.splice(a,1);for(a=-1;++a<globals.monitoredLinks.length;)globals.monitoredLinks[a].id==t&&globals.monitoredLinks.splice(a,1);for(var n=globals.GRAPH.getNode(e.data.fromNodeID),o=globals.GRAPH.getNode(e.data.toNodeID),a=-1;++a<n.data.toNodes.length;)n.data.toNodes[a].id==e.data.toNodeID&&n.data.toNodes.splice(a,1);for(a=-1;++a<o.data.fromNodes.length;)o.data.fromNodes[a].id==e.data.fromNodeID&&o.data.fromNodes.splice(a,1);for(a=-1;++a<n.links.length;)n.links[a].id==e.id&&n.links.splice(a,1);for(a=-1;++a<o.links.length;)o.links[a].id==e.id&&o.links.splice(a,1);for(a=-1;++a<n.data.toLinks.length;)n.data.toLinks[a].id==e.id&&n.data.toLinks.splice(a,1);for(a=-1;++a<o.data.fromLinks.length;)o.data.fromLinks[a].id==e.id&&o.data.fromLinks.splice(a,1);globals.GRAPH.removeLink(e)}function getDataNode(t){for(var e=0;e<globals.nodeList.length;e++)if(globals.nodeList[e].id==t)return globals.nodeList[e]}function getNodesByMatchingLabels(t,e){var a=[];return t.forEach(function(t){var n=!0;e.forEach(function(e){var a=!1;t.data.labels.forEach(function(t){t==e&&(a=!0)}),a||(n=!1)}),n&&a.push(t)}),a}function getNodesByMatchingProperties(t,e){var a=[];return t.forEach(function(t){var n=!0;e.forEach(function(e){var a=!1;t.data.properties.forEach(function(t){e.key==t.key&&e.value==t.value&&(a=!0)}),a||(n=!1)}),n&&a.push(t)}),a}function getNeoLabel(t){var e;return globals.labelsList.forEach(function(a,n){if(a.name==t)return e=a,a}),e}function getDataLink(t){for(var e=0;e<globals.linkList.length;e++)if(globals.linkList[e].data.id==t)return globals.linkList[e]}function getDataLinks(t,e,a){var n=[];return globals.linkList.forEach(function(o,r){switch(a){case"same":o.fromId==Number(t)&&o.toId==Number(e)&&n.push(o);break;case"opposite":o.toId==Number(t)&&o.fromId==Number(e)&&n.push(o);break;default:(o.fromId==Number(t)&&o.toId==Number(e)||o.toId==Number(t)&&o.fromId==Number(e))&&n.push(o)}}),n}function getConfigByPrefix(t){for(var e=0;e<globals.masterConfigs.length;e++)if(globals.masterConfigs[e].prefix==t)return globals.masterConfigs[e]}function fixTextWidth4Link(t){if(t.data.UI.nameTextUI&&t.data.UI.midMarkerUI){var e=t.data.UI.nameTextUI.getBBox().width;if(t.data.UI.nameTextUI.attr("x",-e/2),t.data.UI.fullUI.attr("labelWidth",e),t.data.UI.subTextUI)for(var a=0,n=t.data.UI.subTextUI.getBBox().width;t.data.UI.subTextUI.children[a];)$(t.data.UI.subTextUI.children[a]).attr("x",-n/2),a++}}function showLinkDetails(t){var e=document.getElementById("selectedLink"),a='<p class="panelheader">Selected Link:</a> <p class="dataNameLabel">'+t.data.id+"</p>";a+='<br/><p class="panelheader">Link type</a>: <p class="dataNameLabel">'+t.data.name+"</p>",e.innerHTML=a,a='<a class="panelheader">Properties<a>:',a+='<table style="width:90%;">';e=document.getElementById("linkDetails");t.data.properties.forEach(function(e,n){a+="<tr>";t.data.id,e.value;a+='<td> <p class="dataNameLabel">'+e.key+'</p></td><td><p class="dataValueLabel"> '+e.value+"</p></td>",a+="</tr>"}),a+="</table>",e.innerHTML=a}function highlightRelatedNodes(t,e){globals.GRAPH.forEachLinkedNode(t,function(t,a){globals.graphics.getLinkUI(a.id)&&(a.data.checked||a.data.UI.pathUI.attr("stroke",e?globals.currentTheme.sourceConfig.displaySettings.linkHighlightColor:a.data.color))})}function highlightDescendantNodes(t,e){var a=[];a.push(t);for(var n=0;n<a.length;){var o=getDataNode(a[n]);o.data.toLinks.forEach(function(t){globals.graphics.getLinkUI(t.id)&&(t.data.checked||t.data.UI.pathUI.attr("stroke",e?globals.currentTheme.sourceConfig.displaySettings.linkHighlightColor:t.data.color))}),o.data.toNodes.forEach(function(t){a.indexOf(t.id)<0&&a.push(t.id)}),n++}}function highlightAncestorNodes(t,e){var a=[];a.push(t);for(var n=0;n<a.length;){var o=getDataNode(a[n]);o.data.fromLinks.forEach(function(t){globals.graphics.getLinkUI(t.id)&&(t.data.checked||t.data.UI.pathUI.attr("stroke",e?globals.currentTheme.sourceConfig.displaySettings.linkHighlightColor:t.data.color))}),o.data.fromNodes.forEach(function(t){a.indexOf(t.id)<0&&a.push(t.id)}),n++}}function checkLink(t){showLinkData(t),t.data.UI.pathUI.attr("stroke-width",2*t.data.sourceConfig.displaySettings.linkThickness),t.data.UI.pathUI.attr("stroke","#99ff33"),t.data.checked=!0,globals.checkedLinks.push(t)}function uncheckLink(t){hideLinkData(t),t.data.UI.pathUI.attr("stroke-width",t.data.sourceConfig.displaySettings.linkThickness),t.data.UI.pathUI.attr("stroke",t.data.color),t.data.checked=!1,globals.checkedLinks.map(function(e,a){e.data.id==t.data.id&&globals.checkedLinks.splice(a,1)})}function toggleLink(t,e){1==e&&t.data.checked||(0!=e||t.data.checked)&&(t.data.checked=!t.data.checked,t.data.checked?checkLink(t):uncheckLink(t))}function highlightLink(t){showLinkData(t),t.data.UI.pathUI.attr("stroke-width",2*t.data.sourceConfig.displaySettings.linkThickness)}function unHighlightLink(t){t.data.checked||(hideLinkData(t),t.data.UI.pathUI.attr("stroke-width",t.data.sourceConfig.displaySettings.linkThickness))}function hideLinkData(t){t.data.UI.fullUI.attr("labelVisible","false"),t.data.displayingData&&(t.data.displayingData=!1,t.data.UI.nameTextUI&&t.data.UI.nameTextUI.remove(),t.data.UI.subTextUI&&t.data.UI.subTextUI.remove(),$(t.data.UI.fullUI).hide().show())}function getLinkById(t){for(var e=0;e<globals.linkList.length;e++)if(globals.linkList[e].id==t)return globals.linkList[e]}function showLinkData(t){t.data.UI.fullUI.attr("labelVisible","true"),t.data.displayingData||(t.data.displayingData=!0,t.data.UI.nameTextUI=globals.CommonUI.linkName.cloneNode(),t.data.UI.nameTextUI.innerHTML=t.data.displayLabel,t.data.UI.midMarkerUI&&t.data.UI.midMarkerUI.append(t.data.UI.nameTextUI),globals.currentTheme.sourceConfig.displaySettings.showRelationProperties&&(t.data.UI.subTextUI=globals.CommonUI.linkProps.cloneNode(),t.data.UI.subTextUI.innerHTML=propertyListToSvgList(t.data.properties,'<tspan x="0" dy="1.2em">',"</tspan>"),t.data.UI.midMarkerUI&&t.data.UI.midMarkerUI.append(t.data.UI.subTextUI)),fixTextWidth4Link(t))}function refreshLinkVisual(t){t.data.UI.nameTextUI&&(t.data.UI.nameTextUI.innerHTML=t.data.displayLabel),t.data.UI.subTextUI&&(t.data.UI.subTextUI.innerHTML=propertyListToSvgList(t.data.properties,'<tspan x="0" dy="1.2em">',"</tspan>")),toggleLink(t),toggleLink(t)}function applyPopoutEffectToNode(t,e){globals.layout.pinNode(t,!0);var a=globals.layout.getNodePosition(e),n=Number(t.data.entityConfig.config.attributes.radius);globals.layout.setNodePosition(t.id,getRandomArbitrary(a.x-n/2,a.x+n/2),getRandomArbitrary(a.y-n/2,a.y+n/2)),globals.layout.pinNode(t,!1)}function applyWaitingAffectToNode(t){}function removeWaitingAffectFromNode(t){}function fixTextWidth4Node(t){if(t.data.UI.bodyUI&&t.data.UI.displayTextUI){if(!t.data.sourceConfig.displaySettings.showLabels)return;var e=Number(t.data.entityConfig.config.attributes.radius),a=Number(t.data.UI.bodyUI.getBBox().width),n=a-.1*a,o=Number(t.data.UI.displayTextUI.getBBox().width),r=t.data.UI.displayTextUI.text(),i=Number(t.data.UI.displayTextUI.getBBox().height);if(!r||0==r.length)return;if(t.data.entityConfig.config.attributes.labelText.labelPosition)switch(t.data.entityConfig.config.attributes.labelText.labelPosition){case"above":t.data.UI.displayTextUI.attr("x",-o/2),t.data.UI.displayTextUI.attr("y",-i-e/3);break;case"under":t.data.UI.displayTextUI.attr("x",-o/2),t.data.UI.displayTextUI.attr("y",e+i);break;case"center":t.data.UI.displayTextUI.attr("x",-o/2),t.data.UI.displayTextUI.attr("y",i/3);break;case"right":t.data.UI.displayTextUI.attr("x",e+e/3),t.data.UI.displayTextUI.attr("y",i/3);break;case"left":t.data.UI.displayTextUI.attr("x",-(o+e+e/3)),t.data.UI.displayTextUI.attr("y",i/3)}else{var l=0,s=t.data.entityConfig.config.attributes.labelText.labelSizing;if(o>n)for(;o>=n;){if(l++,"hyphenate"==s)r=r.substring(0,r.length-2)+"'",t.data.UI.displayTextUI.text(r);else{if("fontsize"!=s)return;d=Number(t.data.UI.displayTextUI.attr("font-size"));t.data.UI.displayTextUI.attr("font-size",.9*d)}if(o=Number(t.data.UI.displayTextUI.getBBox().width),l>1e3)return}else if("fontsize"==s)for(l=0;o<n-o;){l++;var d=Number(t.data.UI.displayTextUI.attr("font-size"));if(t.data.UI.displayTextUI.attr("font-size",1.1*d),o=Number(t.data.UI.displayTextUI.getBBox().width),l>1e3)return}i=Number(t.data.UI.displayTextUI.getBBox().height),t.data.UI.displayTextUI.attr("x",-o/2),t.data.UI.displayTextUI.attr("y",i/3)}}if(t.data.UI.popoutBodyUI){var u=0,c=0;t.data.UI.popoutTextUI&&t.data.UI.popoutTextUI.children.length>0&&(u=Number(t.data.UI.popoutTextUI.getBBox().height+20),c=Number(t.data.UI.popoutTextUI.getBBox().width+30));e=Number(t.data.entityConfig.config.attributes.radius);t.data.UI.popoutBodyUI.attr("height",u),t.data.UI.fullUI.attr("style","width:"+c+"px;"),t.data.UI.popoutBodyUI.attr("x",e+10),t.data.UI.popoutTextUI.innerHTML=propertyListToSvgList(t.data.properties,'<tspan x="'+(e+15)+'" dy="1.2em">',"</tspan>")}}function showOnNode(t,e){getDataNode(t).data.displayLabel=e,refreshNodeAppearance(t)}function increaseNodeSprings(t){t||(t=globals.selectedNodeID);var e=getDataNode(t);e.data.toNodes.forEach(function(e){globals.layout.getSpring(t,e.id).length+=10}),e.data.fromNodes.forEach(function(e){globals.layout.getSpring(e.id,t).length+=10})}function increaseNodeDepth(t,e){t||(t=globals.selectedNode),e||(e=.5),t.data.depth+=e,refreshNodesDepths()}function decreaseNodeDepth(t){t||(t=globals.selectedNode)}function decreaseNodeSprings(t){t||(t=globals.selectedNodeID);var e=getDataNode(t);e.data.toNodes.forEach(function(e){globals.layout.getSpring(t,e.id).length-=10}),e.data.fromNodes.forEach(function(e){globals.layout.getSpring(e.id,t).length-=10})}function increaseNodeMass(t){t||(t=globals.selectedNodeID),globals.layout.getBody(t).mass++}function decreaseNodeMass(t){t||(t=globals.selectedNodeID),globals.layout.getBody(t).mass--}function uncheckNode(t){t.data.UI.checkUI&&(t.data.UI.checkUI.remove(),t.data.UI.checkUI=void 0),globals.currentTheme.sourceConfig.displaySettings.loadNodePopouts&&t.data.UI.popoutTextUI&&t.data.UI.popoutTextUI.attr("class","slidetext")}function highlightSelectedNode(t){if(""!=globals.selectedNodeID){if(t==globals.selectedNodeID)return;if("ifany"==globals.config_ext.viewOptions.subnodes.relations)for(;globals.selectedNode.data.subNodes.length>0;)removeSubNode(globals.selectedNode.data.subNodes[0],!1),globals.selectedNode.data.subNodes.splice(0,1);"on-highlight"!=globals.currentTheme.sourceConfig.displaySettings.showRelationships||globals.interactionOptions.checkNodes||globals.selectedNode.data.toLinks.concat(globals.selectedNode.data.fromLinks).forEach(function(t){unHighlightLink(t,!1)}),1==globals.bRelate&&(t!=globals.selectedNodeID&&submitCreateRelation(globals.selectedNodeID,t),globals.bRelate=!1),1==globals.bPlanRelate&&(t!=globals.selectedNodeID&&submitCreateRelation(globals.selectedNodeID,t,!0),globals.bPlanRelate=!1)}var e=globals.GRAPH.getNode(t);if(globals.selectedNodeID=t,globals.selectedNodeData=e.data,globals.selectedNode=e,globals.interactionOptions.checkNodes?checkNode(e):(globals.checkedNodes.forEach(function(t){uncheckNode(t)}),globals.checkedNodes=[]),e.data.toLinks.forEach(function(t){highlightLink(t,!0)}),e.data.fromLinks.forEach(function(t){highlightLink(t,!0)}),addSelectionGraphic(e),loadNodePopout(e,e.data.sourceConfig),showNodeDetailsInToolPanel(e),"ifany"==globals.config_ext.viewOptions.subnodes.relations){var a=e.data.stats.toEntityCount-e.data.toLinks.length;a>0&&addSubNode(e,"subto"+e.id,"#80ffe5",a),(a=e.data.stats.fromEntityCount-e.data.fromLinks.length)>0&&addSubNode(e,"subfrom"+e.id,"#99ccff",a)}}function addSelectionGraphic(t){t.data.UI.fullUI.insertBefore(globals.CommonUI.focusUI,t.data.UI.bodyUI);var e=Number(t.data.entityConfig.config.attributes.radius);t.data.UI.focusUI=globals.CommonUI.focusUI.attr("r",e+e/3).attr("stroke-width",e/5),t.data.UI.focusUI.attr("class","selectionRingOut"),setTimeout(function(){t.data.UI.focusUI.attr("class","selectionRingIn")},200)}function checkNode(t){if(globals.checkedNodes.push(t),!t.data.UI.checkUI){var e=Number(t.data.entityConfig.config.attributes.radius);globals.CommonUI.checkUI.attr("r",e+e/4).attr("stroke-width",e/5),t.data.UI.checkUI=globals.CommonUI.checkUI.cloneNode(),t.data.UI.fullUI.insertBefore(t.data.UI.checkUI,t.data.UI.bodyUI)}globals.currentTheme.sourceConfig.displaySettings.loadNodePopouts&&(t.data.UI.popoutBodyUI||loadNodePopout(t),t.data.UI.popoutTextUI&&t.data.UI.popoutTextUI.attr("class","showtext"))}function loadNodePopout(t,e){if(0!=e.displaySettings.loadNodePopouts){var a=Number(t.data.entityConfig.config.attributes.radius);globals.CommonUI.popoutTextUI.innerHTML=propertyListToSvgList(t.data.properties,'<tspan x="'+(a+15)+'" dy="1.2em">',"</tspan>"),t.data.UI.popoutBodyUI=globals.CommonUI.popoutBodyUI.cloneNode(!0),t.data.UI.fullUI.append(t.data.UI.popoutBodyUI),t.data.UI.popoutTextUI=globals.CommonUI.popoutTextUI.cloneNode(!0),t.data.UI.fullUI.append(t.data.UI.popoutTextUI),fixTextWidth4Node(t),t.data.UI.popoutBodyUI.attr("class","slidebody"),t.data.UI.popoutTextUI.attr("class","slidetext")}}function showNodeDetailsInToolPanel(t){var e=document.getElementById("selectedNode"),a="",n='<div class="panelHead"><p>Selected Entity:</p></div>';n+="<table>",t.data.labels.forEach(function(t,e){0!=e&&(a+=", "),n+="<tr>",n+="  <td>",n+='    <p class="dataNameLabel">Entity Number:</p>',n+="  </td>",n+="  <td>",n+='    <p class="dataValueLabel">'+globals.selectedNodeID+"</p>",n+="  </td>",n+="</tr>",n+="<tr>",n+="  <td>",n+='    <p class="dataNameLabel">Entity Type:</p>',n+="  </td>",n+="  <td>",n+='    <p class="dataValueLabel">'+t+"</p>",n+="  </td>",n+="</tr>"}),n+="</table>",e.innerHTML=n,n='<div class="panelHead"><p>Properties:</p></div>',n+="<table>";e=document.getElementById("nodeDetails");t.data.properties.forEach(function(e,a){n+="<tr>";var o="showOnNode('"+t.id+"', '"+e.value+"')";n+="  <td>",n+='    <button class="paneloption mytooltip" onclick="'+o+'">',n+='      <i class="glyphicon glyphicon-eye-open sm"></i>',n+='      <div class="mytooltiptext ttupper">display in node</div>',n+="    </button>",n+="  </td>",n+="  <td> ",n+='    <p class="dataNameLabel">'+e.key+"</p>",n+="  </td>",n+="  <td>",n+='    <p class="dataValueLabel"> '+e.value+"</p>",n+="  </td>",n+="</tr>"}),n+="</table>",e.innerHTML=n,UiShow_EditEntity(t)}function UiShow_EditEntity(t){var e=document.getElementById("new.entity.name");document.getElementById("panel.entity.props").children[0].innerHTML="",t.data.properties.forEach(function(t){panelAddKeyValue("panel.entity.props","new.entity",t.key,t.value,t.datatype)}),e&&(e.value=t.data.labels[0])}function refreshNodeAppearance(t){var e=globals.GRAPH.getNode(t||globals.selectedNodeID);addNodeToGraph(e.id,e.data),e.data.UI.fullUI.attr("transform","scale("+e.data.depth+")"),e.data.depth>1?e.data.UI.fullUI.attr("opacity",1/e.data.depth):e.data.UI.fullUI.attr("opacity",e.data.depth)}function refreshNodesDepths(){for(var t=[],e=0;e<globals.nodeList.length;e++){for(var a=!1,n=0;n<t.length;n++)if(globals.nodeList[e].data.depth<t[n].data.depth){t.splice(n,0,globals.nodeList[e]),a=!0;break}a||t.push(globals.nodeList[e])}t.forEach(function(t){refreshNodeAppearance(t.id)})}function increaseNodeSize(t){t||(t=globals.selectedNodeID);var e=globals.GRAPH.getNode(t),a=Number(e.data.entityConfig.config.attributes.radius);a+=50/a,e.data.UI.bodyUI.attr("r",a),e.data.UI.imageUI.attr("x",-a).attr("y",-a).attr("rx",a).attr("width",2*a).attr("height",2*a),e.data.toLinks.forEach(function(t){t.data.UI.fullUI.attr("fromNodeRadius",a)}),e.data.fromLinks.forEach(function(t){t.data.UI.fullUI.attr("toNodeRadius",a)}),increaseNodeSprings(e.id),fixTextWidth4Node(e)}function decreaseNodeSize(t){t||(t=globals.selectedNodeID);var e=globals.GRAPH.getNode(t),a=Number(e.data.entityConfig.config.attributes.radius);e.data.entityConfig.config.attributes.radius=a/1.1,addNodeToGraph(e.id,e.data),decreaseNodeSprings(e.id)}function unPinNode(t){globals.layout.pinNode(t,!1),t.data.isPinned=!1}function PerformNodeStatFunctions(t){var e=0,a=t.data.config.nodeStatReachers;0==a.length&&ExecuteNodeTransformers(t);var n=function(){if(e>=a.length)ExecuteNodeTransformers(t);else{var o=a[e].functionName;e+=1,executeReacher(t.data,o,n)}};n()}function ExecuteNodeTransformers(t){t.data.config.nodeTransformers.forEach(function(e){switch(e.name){case"Petalize":petalize_image(t,e.params[0],e.params[1],e.params[2],e.params[3]);break;case"Ringulate":ringulate(t,e.params[0])}})}function executeReacher(t,e,a){var n=function(){a()};switch(e){case"getRelationCounts":getRelationCounts(t,n);break;default:n()}}function getNodeValueWithConstant(t,e){var a=t;return e.split(".").forEach(function(t){a=a[t]}),a}function evaluateAugmentsAndUpdateNodeDisplay(t,e){var a=[];if(t.startupOptions.nodeAugments){t.startupOptions.nodeAugments.map(function(t){t.nodeLabel==e.labels[0]&&(t.property?hasProperty(e.properties,t.property)&&(t.value?hasPropertyWithValue(e.properties,t.property,t.value)&&a.push(t.nodeDisplayBody):a.push(t.nodeDisplayBody)):a.push(t.nodeDisplayBody))});var n={};return a.forEach(function(t){for(var e in t)n[e]=t[e]}),n}}function addPetals(){petalize(globals.selectedNode,15,0,20,"#002533")}function getCircumferenceCoordinates(t,e){for(var a=[],n=0;n<t;n++){var o=0+e*Math.cos(2*Math.PI*n/t),r=0+e*Math.sin(2*Math.PI*n/t);a.push({x:o,y:r})}return a}function petalize_shape(t,e,a,n,o){var r=[];r.push("M 0.03840601,0.01972475 C 8.2867315,0.11675375 31.858718,-12.453976 31.025552,-0.98099125 29.886875,14.699041 -0.03542154,2.5583847 0.03840601,0.01972475 Z");for(var i=360/e,l=getCircumferenceCoordinates(e,n),s=0,d=Viva.Graph.svg("g"),u=0;u<e;u++){var c=Viva.Graph.svg("g"),p=Viva.Graph.svg("path").attr("d",r[a]).attr("fill",o).attr("opacity",.5).attr("transform","translate("+l[u].x+","+l[u].y+") rotate("+s+")");c.append(p),d.append(c),s+=i}t.data.UI.fullUI.insertBefore(d,t.data.UI.bodyUI)}function petalize_image(t,e,a,n,o){var r=0;"number"==typeof e?r=e:"string"==typeof e&&(r=getNodeValueWithConstant(t,e));for(var i=360/r,l=getCircumferenceCoordinates(r,n),s=0,d=Viva.Graph.svg("g"),u=0;u<r;u++){var c=Viva.Graph.svg("g"),p=Viva.Graph.svg("image").link(a).attr("width",Number(o)).attr("height",Number(o)).attr("transform","translate("+l[u].x+","+l[u].y+") rotate("+(s+20)+")");c.append(p),d.append(c),s+=i}t.data.UI.fullUI.insertBefore(d,t.data.UI.displayTextUI)}function ringulate(t,e){var a=0;"number"==typeof e?a=e:"string"==typeof e&&(a=getNodeValueWithConstant(t,e));for(var n=Viva.Graph.svg("g"),o=0;o<a;o++){var r=Viva.Graph.svg("g"),i=Viva.Graph.svg("circle").attr("cx",0).attr("cy",0).attr("r",Number(t.data.entityConfig.config.attributes.radius)+3*o).attr("fill","transparent").attr("stroke",t.data.nodeColor).attr("stroke-width",2);r.append(i),n.append(r)}t.data.UI.fullUI.insertBefore(n,t.data.UI.bodyUI)}function getRelationCounts(t,e){globals.dataService.GetRelationCounts(t.id,function(a,n){t.stats.toEntityCount=a,t.stats.fromEntityCount=n,e()})}function removeSubNode(t,e){1==e&&t.superNodes.forEach(function(e,a){e&&e.subNodes.map(function(a,n){a.id==t.id&&e.subNodes.splice(n,1)})}),t.data.fromLinks.forEach(function(t){globals.GRAPH.removeLink(t.id)}),t.data.toLinks.forEach(function(t){globals.GRAPH.removeLink(t.id)}),globals.GRAPH.removeNode(t.id)}function addSubNode(t,e,a,n){if(!globals.GRAPH.getNode(e)){var o=new nodeDataType;o.nodeSize=5,o.nodeType="subnode",o.id=e,o.labels=["subnode"],o.nodeColor=a,o.displayLabel=n,o.superNodes.push(t);var r=addNodeToGraph(o.id,o);t.data.subNodes.push(r),globals.layout.pinNode(r,!0);var i=globals.layout.getNodePosition(t.id);globals.binaryToggle=!globals.binaryToggle,globals.layout.setNodePosition(r.id,i.x+10*(globals.binaryToggle?-1:1),i.y+10*(globals.binaryToggle?-1:1)),globals.layout.pinNode(r,!1);var l=new linkDataType(parent.id,o.id,parent.id+" "+o.id);l.linkType="sub",l.color="transparent";var s=globals.GRAPH.addLink(t.id,o.id,l);r.data.fromLinks.push(s);var d=globals.layout.getSpring(t.id,o.id);console.log("parentNode",t),d.length=Number(parentnode.data.entityConfig.config.attributes.radius)}}function addSatelliteToNode(t){var e=Number(t.data.entityConfig.config.attributes.radius),a=Viva.Graph.svg("circle").attr("cx",0).attr("cy",0).attr("r",e).attr("fill","transparent").attr("stroke","red").attr("stroke-width","5").attr("stroke-opacity","0.7"),n=Viva.Graph.svg("circle").attr("cx",e).attr("cy",e).attr("r",5).attr("fill","red").attr("stroke","red").attr("opacity",.5).attr("stroke-width",0),o=(Viva.Graph.svg("path").attr("stroke-width",0).attr("d","M 0 -0.7 L 2 0 L 0 0.7 z").attr("fill",t.data.nodeColor),Viva.Graph.svg("g"));o.append(n),o.attr("dx",100),o.attr("dy",100),globals.timeoutElements.push(new timeoutElementType(a,5,removeAnimatedElement)),globals.timeoutElements.push(new timeoutElementType(o,60,removeAnimatedElement)),t.data.UI.fullUI.insertBefore(a,t.data.UI.bodyUI),t.data.UI.fullUI.insertBefore(o,t.data.UI.bodyUI),o.attr("class","rotatee"),a.attr("class","droplet")}function getNeoId(t){return t.substring(3)}function StringHelper(){this.ReplaceEachOfCharSet=function(t,e,a){if(e.length!=e.length)throw"the replacing character-set must be same length as the replaced character set";for(var n="",o=0;o<t.length;o++){n+=t[o];for(var r=0;r<e.length;r++)t[o]===e[r]&&(n=n.slice(0,o)+a[r])}return n},this.IsImage=function(t){if("string"!=getType(t))return!1;var e=t.slice(-4);return".jpg"==e||".png"==e||".gif"==e||".svg"==e||".ico"==e||".jpeg"==t.slice(-5)},this.CompressString=function(t){for(var e,a={},n=(t+"").split(""),o=[],r=n[0],i=256,l=1;l<n.length;l++)null!=a[r+(e=n[l])]?r+=e:(o.push(r.length>1?a[r]:r.charCodeAt(0)),a[r+e]=i,i++,r=e);o.push(r.length>1?a[r]:r.charCodeAt(0));for(l=0;l<o.length;l++)o[l]=String.fromCharCode(o[l]);return o.join("")},this.DecompressString=function(t){for(var e,a={},n=(t+"").split(""),o=n[0],r=o,i=[o],l=256,s=1;s<n.length;s++){var d=n[s].charCodeAt(0);e=d<256?n[s]:a[d]?a[d]:r+o,i.push(e),o=e.charAt(0),a[l]=r+o,l++,r=e}return i.join("")}}function JsonHelper(){function t(t,r,i){return o(t,r)?t=a(t)?mergeArrays(t,r,i):n(t)?mergeObjects(t,r,i):r:e(r)}function e(t){return JSON.parse(JSON.stringify(t))}function a(t){return("array"==typeof t||Array.isArray(t))&&t}function n(t){return"object"==typeof t&&!Array.isArray(t)&&t}function o(t,e){return typeof t==typeof e&&Array.isArray(t)===Array.isArray(e)}this.Contains=function(t,e,r){if(!o(t,e))return!1;if(n(t))for(var i in t)return this.Contains(t[i],e[i]);else{if(!a(t))return"string"==typeof t?r?t===e:t.toLowerCase()===e.toLowerCase():t===e;for(var l=0;l<t.length;l++)return this.Contains(t[l],e[l])}},this.GetValueWithPath=function(t,e){for(var a=e.split("/"),n=t,o=0;o<a.length;o++){if(void 0===n)return;var r=a[o].split("[");n=r.length>1?n[r[0]][Number(r[1].replace("]",""))]:n[r[0]]}return n},this.MergeJson=function(e,a,n){if(!a||!e)throw"JSONMERGE ERROR: Invalid Json input";return t(e,a,n)},mergeObjects=function(a,n,o){var r={};for(var i in a)r[i]=e(a[i]);for(var i in n)void 0===a[i]?r[i]=e(n[i]):r[i]=t(a[i],n[i],o);return r},mergeArrays=function(t,r,i){if(!i)throw"JSONMERGE ERROR: No discriminator specified";var l=[];t.map(t=>l.push(t));for(var s=0;s<r.length;s++){for(var d=!1,u=0;u<t.length;u++)if(function(t,e,r){if(!o(t,e))return!1;if(n(t))return t[r]===e[r]&&t[r];if(function(t){return!n(t)&&!a(t)}(t))return t===e;if(a(t)){for(var i=0;i<t.length;i++)for(var l=0;l<e.length;l++)if(function(e){return"string"==typeof t[i]}()&&t[i]===e[l]&&t[i].startsWith(r+":"))return!0;return!1}throw"JSONMERGE ERROR: unable to compare"}(t[u],r[s],i)){d=!0,n(t[u])?l[u]=mergeObjects(t[u],r[s],i):a(t[u])&&(l[u]=mergeArrays(t[u],r[s],i));break}d||l.push(e(r[s]))}return l}}function GraphHelper(){this.getNodesByName=function(t){for(var e=[],a=0;a<globals.nodeList.length;a++)globals.nodeList[a].data.labels.indexOf(t)>-1&&e.push(globals.nodeList[a]);return e},this.SelectNode=function(t){consoleApp.selectNode(t)},this.AddToEntityTypeDefs=function(t){var e=new EntityTypeDef;labelFound=!1;for(var a=0;a<globals.entityTypeDefs.length;a++)for(var n=globals.entityTypeDefs[a],o=0;o<t.data.labels.length;o++)if(n.labels.indexOf(t.data.labels[o])>-1){labelFound=!0,e=n;break}for(var r in t.data.propertiesObject){e.properties.hasOwnProperty(r)||(e.properties[r]=new PropertyTypeDef);var i=getType(t.data.properties[r]);-1==e.properties[r].DataTypes.indexOf(i)&&e.properties[r].DataTypes.push(i),(new StringHelper).IsImage(t.data.propertiesObject[r])&&-1==e.imageProperties.indexOf(r)&&e.imageProperties.push(r)}labelFound||(e.labels=t.data.labels,globals.entityTypeDefs.push(e))}}function SimpleArranger(){this.Arrange=function(){var t=[],e={};globals.nodeList.forEach(function(a){var n=a.data.labels[0];t.push(n),e[n]?e[n].push(a):e[n]=[a]});var a=0;for(var n in e){a+=100;var o=0;e[n].forEach(function(t){o+=100,globals.layout.pinNode(t,!0),globals.layout.setNodePosition(t.id,o,a)})}}}function BrowserHelper(){this.IsOpera=function(){return!!window.opr&&!!opr.addons||!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0},this.IsFirefox=function(){return"undefined"!=typeof InstallTrigger},this.IsSafari=function(){return/constructor/i.test(window.HTMLElement)||"[object SafariRemoteNotification]"===(!window["safari"]||typeof safari!=="undefined"&&safari.pushNotification).toString()},this.IsInternetExplorer=function(){return!!document.documentMode},this.IsEdge=function(){return!isIE&&!!window.StyleMedia},this.IsChrome=function(){return!!window.chrome},this.IsBlink=function(){return(isChrome||isOpera)&&!!window.CSS}}function UrlHelper(){this.GetParameterByName=function(t,e){e||(e=window.location.href),t=t.replace(/[\[\]]/g,"\\$&");var a=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)").exec(e);return a?a[2]?decodeURIComponent(a[2].replace(/\+/g," ")):"":null},this.GetAllParams=function(t){for(var e,a=/\+/g,n=/([^&=]+)=?([^&]*)/g,o=function(t){return decodeURIComponent(t.replace(a," "))},r=window.location.search.substring(1),i=[];e=n.exec(r);)i.push({key:o(e[1]),value:o(e[2])});return i}}function addNodesFromResults(t,e){for(var a=[],n=0;n<t.results.length;n++)for(var o=t.results[n],r=0;r<o.data.length;r++){var i=o.data[r].row,l=new nodeDataType;l.id=e.prefix+i[0],i[1]&&(l.labels=i[1]),i[2]&&(l.properties=new neoPropertyList(i[2])),i[2]&&(l.propertiesObject=i[2]);var s=addDataNode(l.id,l,e);s&&a.push(s);var d=new nodeDataType;d.id=e.prefix+i[6],i[7]&&(d.labels=i[7]),i[8]&&(d.properties=new neoPropertyList(i[8])),i[8]&&(d.propertiesObject=i[8]);var u=addDataNode(d.id,d,e);u&&a.push(u);var c=new linkDataType(l.id,d.id,e.prefix+i[3],i[4],e);c.properties=new neoPropertyList(i[5]),c.propertiesObject=i[5];addDataLink(l.id,d.id,c,e)}return refreshNodesDepths(),a}function addSingleNodeFromResultsAndReturnIds(t,e){for(var a=[],n=0;n<t.results.length;n++)for(var o=t.results[n],r=0;r<o.data.length;r++){var i=o.data[r].row,l=new nodeDataType;l.id=e.prefix+i[0],i[1]&&(l.labels=i[1]),i[2]&&(l.properties=new neoPropertyList(i[2])),i[2]&&(l.propertiesObject=i[2]),addDataNode(l.id,l,e),a.push(l.id)}return refreshNodesDepths(),a}function addSingleRelationFromResults(t,e){for(var a=0;a<t.results.length;a++)for(var n=t.results[a],o=0;o<n.data.length;o++){var r=n.data[o].row,i=new linkDataType(e.prefix+r[0],e.prefix+r[1],e.prefix+r[2],r[3],e);r[4]&&(i.properties=new neoPropertyList(r[4])),r[4]&&(i.propertiesObject=r[4]);addDataLink(i.fromNodeID,i.toNodeID,i,e)}}function neoPropertyList(t){var e=[];for(var a in t)e.push(new propertyType(a,t[a]));return e}function Neo4jExtractProperties(t){for(var e=[],a=0;a<t.results.length;a++)for(var n=t.results[a],o=0;o<n.data.length;o++){var r=n.data[o].row;e=e.concat(new neoPropertyList(r[0]))}return e}function Neo4jExtractValues(t){for(var e=[],a=0;a<t.results.length;a++)for(var n=t.results[a],o=0;o<n.data.length;o++){var r=n.data[o].row;e.push(r[0])}return e}function Neo4jQbuilder_ClearValue(t){var e=t.split(".");document.getElementById("qbuilder."+e[1]+".value").value=""}function Neo4jQuerySimpleSearch(t,e,a,n){var o=e?"{"+e+":"+parseDataType(a)+"}":"";t&&""!=t&&(t=":"+t);Neo4j_Command(["MATCH (n"+t+o+") RETURN id(n), labels(n), n  LIMIT "+n.dataAccessOptions.generalFetchLimit],function(e,a){addSingleNodeFromResultsAndReturnIds(e,a);Neo4j_Command(["MATCH (n"+t+o+")-[r]-(m) RETURN id(startnode(r)), labels(startnode(r)), startnode(r) , id(r), type(r), r, id(endnode(r)), labels(endnode(r)), endnode(r)  LIMIT "+n.dataAccessOptions.generalFetchLimit],function(t,e){addNodesFromResults(t,e)},a)},n)}function Neo4jFetchEntitiesForNode(t,e){t||(t=globals.selectedNodeID);var a="";switch(globals.viewOptions.navigateDirection){case"child":a="MATCH (n)-[r]->(m) WHERE ID(n) = "+getNeoId(t)+" RETURN id(startnode(r)), labels(startnode(r)), startnode(r) , id(r), type(r), r, id(endnode(r)), labels(endnode(r)), endnode(r) LIMIT "+e.dataAccessOptions.generalFetchLimit;break;case"parent":a="MATCH (n)<-[r]-(m) WHERE ID(n) = "+getNeoId(t)+" RETURN id(startnode(r)), labels(startnode(r)), startnode(r) , id(r), type(r), r, id(endnode(r)), labels(endnode(r)), endnode(r) LIMIT "+e.dataAccessOptions.generalFetchLimit;break;default:a="MATCH (n)-[r]-(m) WHERE ID(n) = "+getNeoId(t)+" RETURN id(startnode(r)), labels(startnode(r)), startnode(r) , id(r), type(r), r, id(endnode(r)), labels(endnode(r)), endnode(r) LIMIT "+e.dataAccessOptions.generalFetchLimit}applyWaitingAffectToNode(t),Neo4j_Command([a],function(e,a){addNodesFromResults(e,a).forEach(function(e){applyPopoutEffectToNode(e,t)})},e)}function Neo4jGetRelationCounts(t,e,a){command="MATCH (n)-[r]->(m) where id(n) = "+getNeoId(t)+" RETURN count(n) UNION MATCH (n)<-[r]-(m) where id(n) = "+getNeoId(t)+" RETURN count(n)";Neo4j_Command([command],function(t,a){for(var n=0;n<t.results.length;n++){var o=t.results[n],r=o.data[0]?o.data[0].row[0]:0,i=o.data[1]?o.data[1].row[0]:0;e(r,i,a)}},a)}function Neo4jGetNodeById(t,e){Neo4j_Command(["MATCH (n) WHERE ID(n) = "+getNeoId(t)+"  RETURN id(n), labels(n), (n)"],function(t,e){addSingleNodeFromResultsAndReturnIds(t,e)},e)}function Neo4jGetNodesByLabel(t,e){var a=getConfigByPrefix(e),n="n";t&&""!=t&&(n+=":"+t),Neo4j_Command(["MATCH ("+n+") RETURN id(n), labels(n), (n) LIMIT "+a.dataAccessOptions.generalFetchLimit],function(t,e){addSingleNodeFromResultsAndReturnIds(t,e)},a)}function Neo4jGetEntitiesByDetails(t,e,a){var n="n";t&&(n+=":"+t);var o="MATCH ("+n+")";if(e&&e.length>0){var r;e.forEach(function(t){r?r+=" AND":r="",r+=" n."+t.key+"="+parseDataType(t.value)}),o+=" WHERE"+r}Neo4j_Command([o+=" RETURN id(n), labels(n), (n) LIMIT "+a.dataAccessOptions.generalFetchLimit],function(t,e){addSingleNodeFromResultsAndReturnIds(t,e)},a)}function Neo4jGetAllEntities(t){Neo4j_Command(["MATCH (n) RETURN id(n), labels(n), (n) LIMIT "+t.dataAccessOptions.generalFetchLimit],function(e,a){addSingleNodeFromResultsAndReturnIds(e,a),globals.dataService.GetAllRelations(t)},t)}function Neo4jGetAllRelations(t){Neo4j_Command(["MATCH (n)-[r]->(m) RETURN id(n), id(m), id(r), type(r), r LIMIT "+t.dataAccessOptions.generalFetchLimit],function(t,e){addSingleRelationFromResults(t,e)},t)}function Neo4jFetchRelation(t,e,a){command="MATCH (n)-[r]-(m) WHERE ID(n) = "+getNeoId(t)+" and ID(m) = "+getNeoId(e)+" RETURN id(startnode(r)), labels(startnode(r)), startnode(r) , id(r), type(r), r, id(endnode(r)), labels(endnode(r)), endnode(r)";Neo4j_Command([command],function(t,e){addNodesFromResults(t,e)},a)}function Neo4jCreateEntityReturnCallbackWithIds(t,e,a){var n=globals.currentTheme.sourceConfig,o="CREATE (n:"+t+_convertPropertyListToNeo4jString(e)+") return id(n), labels(n), n";return console.log("command",o),Neo4j_Command([o],function(t,e){var n=addSingleNodeFromResultsAndReturnIds(t,e);a&&a(n)},n)}function _convertPropertyListToNeo4jString(t){var e="";t.length>0&&(e+="{");for(var a=0;a<t.length;a++)a>0&&(e+=","),e+=t[a].key+":",t[a].datatype,e+=t[a].value;return t.length>0&&(e+="}"),e}function Neo4jUpdateEntity(t,e,a){var n=globals.currentTheme.sourceConfig;Neo4j_Command(["MATCH (n) WHERE ID(n)="+getNeoId(t)+e+" return id(n), labels(n), n"],function(t,e){addSingleNodeFromResultsAndReturnIds(t,e),inputCallback&&inputCallback(ids)},n)}function Neo4jCreateRelation(t,e,a,n,o,r){if(r)addPlannedLink(t,e,a,n);else{Neo4j_Command(["MATCH (n) WHERE ID(n) = "+getNeoId(t)+" MATCH (m) WHERE ID(m) = "+getNeoId(e)+" CREATE (n)-[r:"+a+n+"]->(m) RETURN id(startnode(r)), labels(startnode(r)), startnode(r) , id(r), type(r), r, id(endnode(r)), labels(endnode(r)), endnode(r)"],function(a,n){Neo4jFetchRelation(t,e,n)},o)}}function Neo4jCreateNode(t,e){Neo4j_Command(["CREATE (n:"+t+") RETURN id(n), labels(n), n"],function(t,e){addSingleNodeFromResultsAndReturnIds(t,e)},e)}function Neo4jDeleteNode(t,e){Neo4j_Command(["MATCH (n) where ID(n) = "+getNeoId(t)+" DETACH DELETE (n) RETURN ID(n)"],function(e,a){removeNodeFromStage(t)},e)}function Neo4jDeleteRelationship(t,e){Neo4j_Command(["MATCH (n)-[r]->(m) where ID(r) = "+getNeoId(t)+" DELETE (r) RETURN ID(r)"],function(e,a){removeLinkFromStage(t)},e)}function Neo4jDeleteLabel(t,e,a){var n=function(t,e){Neo4jGetNodeById(globals.selectedNodeID,e)};Neo4j_Command(["MATCH (n) where ID(n) = "+getNeoId(t)+" REMOVE n:"+e],n,a,n)}function Neo4jAddProperty(t,e){t||(t=globals.selectedNodeID);var a=document.getElementById("add.property.key").value,n=document.getElementById("add.property.value").value,o=document.getElementById("add.property.type").value;o||(o="string"),"string"==o&&(n='"'+n+'"');var r=function(t,e){Neo4jGetNodeById(globals.selectedNodeID,e)};Neo4j_Command(["MATCH (n) where ID(n) = "+getNeoId(t)+" SET n +={"+a+":"+n+"}"],r,e,r)}function Neo4jAddLabel(t){var e=document.getElementById("log");if(e&&e.value){var a=function(t,e){Neo4jGetNodeById(globals.selectedNodeID,e)};Neo4j_Command(["MATCH (n) where ID(n) = "+getNeoId(globals.selectedNodeID)+" SET n:"+e.value],a,t,a)}}function Neo4jGetAllLabels(t){Neo4j_Command(["match (n) return labels(n), count(labels(n))"],function(t,e){t.results[0].data.forEach(function(t){}),refreshEntitySelectors()},t)}function Neo4j_Command(t,e,a,n){var o=a||globals.currentTheme.sourceConfig,r=new neo_APIcall;t.forEach(function(t){r.statements.push(new neo_Statement(t))}),$.ajax({url:o.neo4jconnection.server+"/db/data/transaction/commit",type:"post",data:JSON.stringify(r),headers:{Accept:"application/json; charset=UTF-8","Content-Type":"application/json",Authorization:"Basic "+window.btoa(o.neo4jconnection.username+":"+o.neo4jconnection.password)},dataType:"json",success:function(t){e&&e(t,o)},error:void(n&&n(void 0,o))})}function Neo4jCheckMonitoredNodes(t){if(0!=globals.monitoredNodes.length){var e=0,a=function(t,n){if(addSingleNodeFromResultsAndReturnIds(t,n),e>=globals.monitoredNodes.length)return performAnimations(),void setTimeout(function(){globals.dataService.CheckMonitoredLinks()},1e3*globals.config_ext.monitoringOptions.pollInterval);Neo4j_Command(["MATCH (n) WHERE ID(n) = "+getNeoId(globals.monitoredNodes[e++].id)+" RETURN id(n), labels(n), n"],a,n)};Neo4j_Command(["MATCH (n) WHERE ID(n) = "+getNeoId(globals.monitoredNodes[e++].id)+" RETURN id(n), labels(n), n"],a,t)}}function Neo4jCheckMonitoredLinks(t){if(0!=globals.monitoredLinks.length){var e=0,a=function(t,n){if(addSingleRelationFromResults(t),e>=globals.monitoredLinks.length)return performAnimations(),void setTimeout(function(){pollDatabase()},1e3*globals.config_ext.monitoringOptions.pollInterval);Neo4j_Command(["MATCH (n)-[r]-(m) WHERE ID(r) = "+getNeoId(globals.monitoredLinks[e++].data.id)+" RETURN id(n), id(m), id(r), type(r), r"],a,n)};Neo4j_Command(["MATCH (n)-[r]-(m) WHERE ID(r) = "+getNeoId(globals.monitoredLinks[e++].data.id)+" RETURN id(n), id(m), id(r), type(r), r"],a,t)}}function Neo4jQbuilder(t,e){var a=t.split("."),n=document.getElementById("qbuilder."+a[1]+".entity").value,o=n.substring(n.length-3),r=n.substring(0,n.length-3);getNeoLabel(r,o);if("entity"==a[2]){s="qbuilder."+a[1]+".selectproperty";document.getElementById("qbuilder."+a[1]+".value").value="";var i="qbuilder."+a[1]+".property",l=[];document.getElementById(i).innerHTML='<option value=""></option>',document.getElementById("qbuilder."+a[1]+".selectvalue").innerHTML='<option value=""></option>',Neo4j_Command([u="MATCH (n:"+r+") RETURN n LIMIT 10 "],c=function(t,e){var a=Neo4jExtractProperties(t),n=document.getElementById(s);n.innerHTML='<option value=""></option>',a.sort(sort_by("key",!1,function(t){return t.toUpperCase()})).forEach(function(t){-1==l.indexOf(t.key)&&(l.push(t.key),n.innerHTML+='<option value="'+t.key+'">'+t.key+"</option>")})},getConfigByPrefix(o))}if("property"==a[2]){var s="qbuilder."+a[1]+".selectvalue";document.getElementById("qbuilder."+a[1]+".value").value="";var d=document.getElementById("qbuilder."+a[1]+".property").value,l=[];if(!d)return;var u="MATCH (n:"+r+") return distinct n."+d+" LIMIT "+getConfigByPrefix(o).dataAccessOptions.generalFetchLimit,c=function(t,e){var a=Neo4jExtractValues(t),n=document.getElementById(s);n.innerHTML='<option value=""></option>',a.sort().forEach(function(t){-1==l.indexOf(t)&&(l.push(t),n.innerHTML+='<option value="'+t+'">'+t+"</option>")})};Neo4j_Command([u],c,getConfigByPrefix(o))}}function addNodesToGraphFromGraphElementsAndReturnNodes(t,e){var a=[];return t.forEach(function(t){var n=new nodeDataType;n.id=t.fromNode.id,n.labels=t.fromNode.labels,n.properties=new neoPropertyList(t.fromNode.properties),n.propertiesObject=t.fromNode.properties,n.entityConfig=GetConfigForEntityId(n.id);var o=addDataNode(n.id,n,e);o&&a.push(o);var r=new nodeDataType;r.id=t.toNode.id,r.labels=t.toNode.labels,r.properties=new neoPropertyList(t.toNode.properties),r.propertiesObject=t.toNode.properties,r.entityConfig=GetConfigForEntityId(r.id);var i=addDataNode(r.id,r,e);i&&(a.push(i),applyPopoutEffectToNode(i,n.id));var l=new linkDataType(n.id,r.id,t.link.id,t.link.labels,e);l.properties=new neoPropertyList(t.link.properties),l.propertiesObject=t.link.properties;addDataLink(n.id,r.id,l,e)}),refreshNodesDepths(),a}function addRelationToGraphReturnLink(t,e){var a=new linkDataType(t.fromNodeId,t.toNodeId,t.id,t.labels,e);return t.properties&&(a.properties=new neoPropertyList(t.properties)),t.properties&&(a.propertiesObject=t.properties),t=addDataLink(a.fromNodeID,a.toNodeID,a,e)}function addEntitiesToGraphAndReturnNodes(t,e){var a=[];return t.forEach(function(t){var n=new nodeDataType;n.id=t.id,n.labels=t.labels||[],n.properties=new neoPropertyList(t.properties),n.propertiesObject=t.properties,n.entityConfig=GetConfigForEntityId(t.id);var o=addDataNode(t.id,n,e);a.push(o)}),a}function GetConfigForEntityId(t){return(new ConfigHelper).GetConfigForEntityId(t)}function removeNodeFromGraph(t){removeNodeFromStage(t.id)}function checkTimeoutElements(){setTimeout(function(){for(var t=0;t<globals.timeoutElements.length;){var e=globals.timeoutElements[t];+new Date>e.activationPoint+1e3*e.duration?(e.fnRemove(e.element),globals.timeoutElements.splice(t,1)):t++}checkTimeoutElements()},1e3)}function performAnimations(){globals.animUpdateNodes.forEach(function(t){addSatelliteToNode(t)}),globals.animUpdateNodes=[],globals.animUpdateLinks.forEach(function(t){var e=Viva.Graph.svg("circle").attr("cx",1).attr("cy",1).attr("r",.5).attr("fill","red").attr("stroke","red").attr("opacity",.5).attr("stroke-width",0),a=Viva.Graph.svg("g");a.append(e),globals.timeoutElements.push(new timeoutElementType(a,60,removeAnimatedElement)),t.data.UI.midMarkerUI.append(a),a.attr("class","rotatee")}),globals.animUpdateLinks=[]}function removeAnimatedElement(t){t.remove()}function animateTest(t){t||(t=globals.selectedNode);var e=globals.graphics.getNodeUI(t.id);circlex=Viva.Graph.svg("circle").attr("cx",0).attr("cy",0).attr("r",Number(t.data.entityConfig.config.attributes.radius)).attr("fill","transparent").attr("stroke","red").attr("stroke-width","5").attr("stroke-opacity","0.7"),e.append(circlex),circlex.attr("class","droplet");Number(t.data.entityConfig.config.attributes.radius);var a=Viva.Graph.svg("g"),n="";n+="M -13 10 C ",n+="-13 48,",n+="37 48,",n+="37 10";Viva.Graph.svg("path").attr("d",n).attr("stroke","blue");circley=Viva.Graph.svg("circle").attr("cx",0).attr("cy",0).attr("r",t.data.entityConfig.config.attributes.radius).attr("fill","blue").attr("stroke","red"),circletiny=Viva.Graph.svg("circle").attr("cx",20).attr("cy",30).attr("r",5).attr("fill","red").attr("stroke","red").attr("opacity",.5).attr("stroke-width",0),a.append(circletiny),a.attr("dx",100),a.attr("dy",100),e.append(a),a.attr("class","rotatee")}function clearAllMonitored(){for(;globals.monitoredNodes.length>0;)removeMonitoredNode(globals.monitoredNodes[0].id);for(;globals.monitoredLinks.length>0;)removeMonitoredLink(globals.monitoredLinks[0].data.id)}function monitorNode(t){var e=!1;globals.monitoredNodes.map(function(a){a.id==t.id&&(e=!0)}),e||(globals.monitoredNodes.push(t),addValueToList("nodelist.monitored",'<button class="fortext mytooltip" onclick="removeMonitoredNode('+t.id+')" >X<div class="mytooltiptext">stop monitoring</div></button>',"node:",t.id))}function monitorLink(t){var e=!1;globals.monitoredLinks.map(function(a){a.data.id==t.data.id&&(e=!0)}),e||(globals.monitoredLinks.push(t),addValueToList("nodelist.monitored",'<button class="fortext mytooltip" onclick="removeMonitoredLink('+t.data.id+')" >X<div class="mytooltiptext">stop monitoring</div></button>',"link:",t.data.id))}function monitorCheckedItems(){globals.selectedNode&&monitorNode(globals.selectedNode),globals.checkedNodes.forEach(function(t){monitorNode(t)}),globals.checkedLinks.forEach(function(t){monitorLink(t)}),pollDatabase()}function removeMonitoredNode(t){var e=-1;if(globals.monitoredNodes.map(function(a,n){a.id==t&&(e=n)}),e>-1){globals.monitoredNodes.splice(e,1);for(var a=document.getElementById("nodelist.monitored"),n=0;n<a.children.length;n++)a.children[n].children[0].children[2].innerHTML==t&&"node:"==a.children[n].children[0].children[1].innerHTML&&a.children[n].remove()}}function removeMonitoredLink(t){var e=-1;if(globals.monitoredLinks.map(function(a,n){a.data.id==t&&(e=n)}),e>-1){globals.monitoredLinks.splice(e,1);for(var a=document.getElementById("nodelist.monitored"),n=0;n<a.children.length;n++)a.children[n].children[0].children[2].innerHTML==t&&"link:"==a.children[n].children[0].children[1].innerHTML&&a.children[n].remove()}}function pollDatabase(){setTimeout(function(){globals.dataService.CheckMonitoredNodes()},1e3*globals.config_ext.monitoringOptions.pollInterval)}function Entity(){this.labels,this.properties,this.relations}function Relationship(){this.properties,this.labels,this.fromEntity,this.toEntity}function DataEntity(){this.id=0,this.labels=[],this.properties={},this.relationIds=[]}function DataRelation(){this.properties,this.labels,this.id,this.fromEntityId,this.toEntityId}function interactionOptionsType(){return this.checkNodes=!1,this}function linkDataType(t,e,a,n,o){return this.linkType="data",this.fromNodeID=t,this.toNodeID=e||-1,this.id=a||-1,this.color=globals.currentTheme.linkColor,this.thickness=1,this.name=n||"",this.displayLabel="",this.properties=[],this.UI=new linkUiElementsType,this.checked=!1,this.displayingData=!1,this.config={},this.sourceConfig=globals.currentTheme.sourceConfig,this.config.linkDisplayValues={},o&&(this.color=o.displaySettings.linkColor),this}function linkUiElementsType(){return this.fullUI,this.pathUI,this.focusUI,this.toMarkerUI,this.fromMarkerUI,this.midMarkerUI,this.nameTextUI,this.subTextUI,this.popoutBodyUI,this.popoutTextUI,this}function neo_APIcall(){return this.statements=[],this}function neo_Statement(t){return this.statement=t,this}function neo4jConnectionType(t,e,a,n){this.name=t,this.username=a,this.password=n,this.server=e,this.userToken=window.btoa(a+":"+n)}function neoLabelType(t,e,a,n){return this.data={},this.data.sourceConfig=n,this.instanceCount=0,this.name=t,this.color=e,this.colorRGB=a,this}function nodeDataType(){return this.nodeType="data",this.source,this.id=0,this.labels=[],this.nodeSize=25,this.nodeColor="#808080",this.depth=1,this.nodeBorderColor="#808080",this.nodeShape="circle",this.height=25,this.width=25,this.properties=[],this.propertiesObject={},this.nodeColorRGB={r:100,g:100,b:100},this.nodeOpacity="1",this.textColor="#ffffff",this.displayLabel="",this.circleText="",this.isPinned=!1,this.properties=[],this.toLinks=[],this.fromLinks=[],this.toNodes=[],this.fromNodes=[],this.subNodes=[],this.superNodes=[],this.UI=new nodeUiElementsType,this.config={},this.sourceConfig=globals.currentTheme.sourceConfig,this.config.nodeDisplayBody={},this.config.nodeDisplayValues={},this.config.nodeStatReachers=[],this.config.nodeFlyout=[],this.config.nodeTransformers=[],this.stats={},this.stats.toEntityCount=0,this.stats.fromEntityCount=0,this}function propertyType(t,e){return this.key=t,this.value=e,this.datatype=getType(e),this}function nodeUiElementsType(){return this.outerUI,this.fullUI,this.bodyUI,this.imageUI,this.focusUI,this.checkUI,this.displayTextUI,this.popoutUI,this.popoutInfoUI,this.popoutBodyUI,this.popoutTextUI,this}function linkUiElementsType(){return this.fullUI,this.pathUI,this.focusUI,this.toMarkerUI,this.fromMarkerUI,this.midMarkerUI,this.nameTextUI,this.subTextUI,this.popoutBodyUI,this.popoutTextUI,this}function linkDataType(t,e,a,n,o){return this.linkType="data",this.fromNodeID=t,this.toNodeID=e||-1,this.id=a||-1,this.color=globals.currentTheme.linkColor,this.thickness=1,this.name=n||"",this.displayLabel="",this.properties=[],this.UI=new linkUiElementsType,this.checked=!1,this.displayingData=!1,this.config={},this.sourceConfig=globals.currentTheme.sourceConfig,this.config.linkDisplayValues={},o&&(this.color=o.displaySettings.linkColor),this}function timeoutElementType(t,e,a){this.fnRemove=a,this.duration=e,this.activationPoint=+new Date,this.element=t}function neo4jConnectionType(t,e,a,n){this.name=t,this.username=a,this.password=n,this.server=e,this.userToken=window.btoa(a+":"+n)}function neoLabelType(t,e,a,n){return this.data={},this.data.sourceConfig=n,this.instanceCount=0,this.name=t,this.color=e,this.colorRGB=a,this}function viewOptionsType(){return this.screenDragType=!0,this.highlightRelated=!0,this.highlightAncestors=!1,this.highlightdescendants=!1,this.navigateDirection="both",this}function interactionOptionsType(){return this.checkNodes=!1,this}function neo_APIcall(){return this.statements=[],this}function neo_Statement(t){return this.statement=t,this}function nodeUiElementsType(){return this.outerUI,this.fullUI,this.bodyUI,this.imageUI,this.focusUI,this.checkUI,this.displayTextUI,this.popoutUI,this.popoutInfoUI,this.popoutBodyUI,this.popoutTextUI,this}function node_Event(t,e,a,n){"MouseEnter"==t?node_OnMouseEnter(e,a,n):"mousedown"==t?node_OnMouseDown(e,a,n):"mouseup"==t?node_OnMouseUp(e,a,n):"dblclick"==t?node_OnMouseDblClick(e,a,n):"MouseLeave"==t?node_OnMouseLeave(e,a,n):"MouseDragging"==t?node_OnDrag(e,a,n):"SubNodePulledOut"==t?node_Event_subNodePulledOut(e,a,n):"touchstart"==t?node_OnTouchStart(e,a,n):"tap"==t?node_OnTap(e,a,n):"touchend"==t&&node_OnTouchEnd(e,a,n)}function node_Event_subNodePulledOut(t,e,a){nodeLayer.attr("parentnodeid",t.data.superNodes[0])}function nodeFlyout_Event_HideClick(t){removeNodeFromGraph(t)}function nodeFlyout_Event_PinClick(t){unPinNode(globals.GRAPH.getNode(t))}function node_OnMouseEnter(t,e,a){"data"==t.data.nodeType?dataNode_OnMouseEnter(t,e,a):"subnode"==t.data.nodeType?subNode_OnMouseEnter(t,e,a):"planned"==t.data.nodeType&&plannedNode_OnMouseEnter(t,e,a)}function node_OnTap(t,e,a){node_OnMouseDown(t,e,a)}function node_OnTouchStart(t,e,a){node_OnMouseDown(t,e,a)}function node_OnTouchEnd(t,e,a){node_OnMouseUp(t,e,a)}function node_OnMouseDown(t,e,a){t.data.dragging="true","data"==t.data.nodeType?dataNode_OnMouseDown(t,e,a):"subnode"==t.data.nodeType?subNode_OnMouseDown(t,e,a):"planned"==t.data.nodeType&&plannedNode_OnMouseDown(t,e,a)}function node_OnMouseDblClick(t,e,a){"data"==t.data.nodeType?dataNode_OnMouseDblClick(t,e,a):"subnode"==t.data.nodeType?subNode_OnMouseDblClick(t,e,a):"planned"==t.data.nodeType&&plannedNode_OnMouseDblClick(t,e,a)}function node_OnMouseLeave(t,e,a){"data"==t.data.nodeType?dataNode_OnMouseLeave(t,e,a):"subnode"==t.data.nodeType?subNode_OnMouseLeave(t,e,a):"planned"==t.data.nodeType&&plannedNode_OnMouseLeave(t,e,a)}function node_OnMouseUp(t,e,a){t.data.dragging="false","data"==t.data.nodeType?dataNode_OnMouseUp(t,e,a):"subnode"==t.data.nodeType?subNode_OnMouseUp(t,e,a):"planned"==t.data.nodeType&&plannedNode_OnMouseUp(t,e,a)}function node_OnDrag(t,e,a){"data"==t.data.nodeType?dataNode_OnDrag(t,e,a):"subnode"==t.data.nodeType?subNode_OnDrag(t,e,a):"planned"==t.data.nodeType&&plannedNode_OnDrag(t,e,a)}function dataNode_OnMouseEnter(t,e,a){globals.viewOptions.highlightRelated&&highlightRelatedNodes(t.id,!0),globals.viewOptions.highlightdescendants&&highlightDescendantNodes(t.id,!0),globals.viewOptions.highlightAncestors&&highlightAncestorNodes(t.id,!0)}function dataNode_OnMouseDown(t,e,a){(new GraphHelper).SelectNode(t),highlightSelectedNode(t.id),globals.nodeFunctions=NodeFunctionsFactory.createNew(t),globals.layout.pinNode(t,!0),t.data.isPinned=!0}function dataNode_OnMouseUp(t,e,a){globals.consoleService.ShowFlyout(t,e,a)}function dataNode_OnMouseDblClick(t,e,a){globals.dataService.FetchEntitiesForNodeId(t.id,t.data.sourceConfig)}function dataNode_OnMouseLeave(t,e,a){globals.viewOptions.highlightRelated&&highlightRelatedNodes(t.id,!1),globals.viewOptions.highlightdescendants&&highlightDescendantNodes(t.id,!1),globals.viewOptions&&highlightAncestorNodes(t.id,!1)}function dataNode_OnDrag(t,e,a){}function subNode_OnMouseEnter(t,e,a){}function subNode_OnDblClick(t,e,a){}function subNode_OnMouseLeave(t,e,a){}function subNode_OnMouseDown(t,e,a){}function subNode_OnMouseUp(t,e,a){t.data.UI.fullUI.attr("dragging","false"),t.data.UI.fullUI.children[0].attr("r",Number(t.data.entityConfig.config.attributes.radius)),fixTextWidth4Node(t,e,a)}function subNode_OnDrag(t,e,a){var n=t.data.UI.fullUI,o=n.attr("parentnodeid"),r=calculateDistance(globals.layout.getNodePosition(o),globals.layout.getNodePosition(nodeid));new EventsHelper(t).distancePassedThreshold(r)&&nodeEvent("SubNodePulledOut",t),n.children[0].attr("r",r/5),fixTextWidth4Node(globals.GRAPH.getNode(nodeid))}function plannedNode_OnMouseEnter(t,e,a){}function plannedNode_OnDblClick(t,e,a){}function plannedNode_OnMouseLeave(t,e,a){}function plannedNode_OnMouseDown(t,e,a){}function plannedNode_OnMouseUp(t,e,a){}function plannedNode_OnDrag(t,e,a){}function nodeAppearanceHelper(t){var e=t.data.entityConfig.config;this.node=t,this.nodeGraphics=[],this.nodeEffects=[],this.addNodeBody=function(){var a=Number(e.attributes.radius),n=Viva.Graph.svg(e.attributes.shape).attr("cx",0).attr("cy",0).attr("width",a).attr("height",a).attr("r",a).attr("fill",null==e.attributes["background-color"]?"grey":e.attributes["background-color"]).attr("stroke-width",3).attr("stroke",null==e.attributes["border-color"]?"black":e.attributes["border-color"]);return"rect"==e.attributes.shape&&(n.attr("width",3*a),n.attr("height",2*a),n.attr("rx",a/4),n.attr("x",-3*a/2),n.attr("y",-2*a/2)),1==e.effects.haze&&n.attr("filter","url(#hazeEffect)"),1==e.effects.glass&&n.attr("fill","url(#gradGlass)"),1==e.effects.rounded&&n.attr("fill","url(#gradRound)"),1==!e.effects.opaque&&n.attr("fill-opacity",e.attributes.opacity),t.data.UI.bodyUI=n,this.nodeGraphics.push(n),n},this.addNodeImage=function(){var t="";t="property"===e.attributes.img.displayData.key?this.node.data.propertiesObject[e.attributes.img.displayData.value]:"static"===e.attributes.img.displayData.key?e.attributes.img.displayData.value:e.attributes.img.url;var a=Number(e.attributes.img.width),n=Number(e.attributes.img.height);t&&0===a&&(a=100),t&&0===n&&(n=100);var o=Viva.Graph.svg("image").attr("width",a).attr("height",n).attr("x",-a/2).attr("y",-n/2).attr("opacity",Number(e.attributes.img.opacity)).link(t);return 1==e.effects.rounded&&o.attr("fill","url(#gradRound)"),this.node.data.UI.imageUI=o,this.nodeGraphics.push(o),o},this.addNodeOption=function(t){return nodeOption=Viva.Graph.svg("image").attr("x",t.x).attr("y",t.y).attr("width",t.size).attr("height",t.size).attr("fill",t.color).link(t.url),this.node.data.UI.options.push(nodeOption),this.nodeGraphics.push(nodeOption),nodeOption},this.addNodeLine=function(){var t=Math.ceil(getRandomArbitrary(40,90)),e=Math.ceil(getRandomArbitrary(40,90)),a=Math.ceil(getRandomArbitrary(0,360));Math.ceil(getRandomArbitrary(-1,1)),Math.ceil(getRandomArbitrary(-1,1));return nodeLine=Viva.Graph.svg("line").attr("x1",0).attr("y1",0).attr("x2",t).attr("y2",e).attr("style","stroke:url(#gradShine);transform:rotate("+a+"deg);").attr("stroke-width","2"),this.node.data.UI.options.push(nodeLine),this.nodeGraphics.push(nodeLine),nodeLine},this.addNodeText=function(){if(e.attributes.labelText.show){var t=Viva.Graph.svg("text").attr("y",Number(e.attributes.labelText.x)).attr("x",Number(e.attributes.labelText.y)).attr("fill",e.attributes.labelText.color).attr("font-family",e.attributes.labelText["font-family"]).attr("font-weight",e.attributes.labelText["font-weight"]).attr("font-size","20").text(this.node.data.displayLabel);return this.node.data.UI.displayTextUI=t,this.nodeGraphics.push(t),t}},this.addNodeCircleTextPath=function(){if(e.attributes.circleText.show){var t=Number(e.attributes.radius)+5,a=Viva.Graph.svg("path").attr("id","npath_"+this.node.data.id).attr("d",`\n\t\t\t\tM 0, 0\n\t\t\t\tm -${t}, 0\n\t\t\t\ta ${t}, ${t} 0 1, 0 ${2*t}, 0\n\t\t\t\ta ${t}, ${t} 0 1, 0 -${2*t}, 0`).attr("fill","transparent").attr("style","transform:rotate(90deg);");return this.node.data.UI.circleTextPath=a,this.nodeGraphics.push(a),a}},this.addNodeCircleText=function(){if(e.attributes.circleText.show){var t=Viva.Graph.svg("text").attr("y",0).attr("x",0).attr("fill",e.attributes.circleText.color).attr("opacity",e.attributes.circleText.opacity).attr("font-size","10");return t.innerHTML+='<textPath alignment-baseline="hanging" text-anchor="middle" xlink:href="#npath_'+this.node.data.id+'" startOffset="50%">'+this.node.data.circleText+"</textPath>",this.node.data.UI.circleText=t,this.nodeGraphics.push(t),t}},this.addEffect=function(t,e){this.nodeEffects.push({name:t,definition:e,definition:e})},this.compileNode=function(e){t.data.UI.fullUI=e;for(var a="<defs>",n=0;n<this.nodeEffects.length;n++)a+=this.nodeEffects[n].definition;a+="</defs>",e.innerHTML=a,this.nodeGraphics.forEach(function(t){e.append(t)})}}function defineNodeAppearance_dataNode(t,e){var a=t.data.entityConfig.config;e.attr("class","datanode"),t.data.UI={bodyUI:void 0,imageUI:void 0,displayTextUI:void 0,options:[],circleTextPath:void 0,circleText:void 0};var n=new nodeAppearanceHelper(t);n.addNodeBody(),n.addNodeImage(),n.addNodeText(),n.addNodeCircleTextPath(),n.addNodeCircleText(),a.relatedThings.forEach(function(t){"option"===t.thingName&&n.addNodeOption(t)}),n.addEffect("hazeEffect",'<filter id="hazeEffect" x="-1" y="-1" width="300%" height="300%"><feOffset result="offOut" in="FillPaint" dx="0" dy="0" /><feGaussianBlur result="blurOut" in="offOut" stdDeviation="10" /><feBlend in="SourceGraphic" in2="blurOut" mode="normal" /></filter>'),n.addEffect("shadowEffect",'<filter id="shadowEffect" x="-1" y="-1" width="300%" height="300%"><feOffset result="offOut" in="SourceAlpha" dx="20" dy="20" /><feGaussianBlur result="blurOut" in="offOut" stdDeviation="10" /><feBlend in="SourceGraphic" in2="blurOut" mode="normal" /></filter>'),n.addEffect("gradGlass",'\n\t\t<linearGradient id="gradGlass" gradientUnits="userSpaceOnUse" x1="0%" y1="0%" x2="0%" y2="100%">\n\t\t\t<stop offset="0%" stop-color="#606768" stop-opacity="0.3"/>\n\t\t\t<stop offset="3%" stop-color="#bbbbbb" stop-opacity="0.3"/>\n\t\t\t<stop offset="27%" stop-color="#bbbbbb" stop-opacity="0.3"/>\n\t\t\t<stop offset="28%" stop-color="#000000" stop-opacity="0.3"/>\n\t\t\t<stop offset="73%" stop-color="#000000" stop-opacity="0.3"/>\n\t\t\t<stop offset="88%" stop-color="#4b5051" stop-opacity="0.3"/>\n\t\t\t<stop offset="97%" stop-color="#000000" stop-opacity="0.3"/>\n\t\t\t<stop offset="100%" stop-color="#000000" stop-opacity="0.3"/>\n\t\t</linearGradient>'),n.addEffect("gradShine",'\n\t\t<linearGradient id="gradShine" x1="0%" y1="0%" x2="100%" y2="100%">\n\t\t\t<stop offset="0%"   stop-color="white" stop-opacity="0.7"/>\n\t\t\t<stop offset="100%"  stop-color="purple" stop-opacity="0"/>\n\t\t</linearGradient>\n\t'),n.addEffect("gradRound",'<radialGradient id="gradRound" cx="50%" cy="50%" r="50%" fx="50%" fy="50%"><stop offset="80%" style="stop-color:rgb('+t.data.nodeColorRGB.r+","+t.data.nodeColorRGB.g+","+t.data.nodeColorRGB.b+'); stop-opacity:1" /><stop offset="100%" style="stop-color:rgb('+(t.data.nodeColorRGB.r-100)+","+(t.data.nodeColorRGB.g-100)+","+(t.data.nodeColorRGB.b-100)+');stop-opacity:1" /></radialGradient>'),n.compileNode(e)}function defineNodeAppearance_plannedNode(t,e){var a=t.data.sourceConfig.displaySettings,n=t.data.config.nodeDisplayBody;n.color&&(t.data.nodeColor=n.color);var o=Number(t.data.entityConfig.config.attributes.radius);nodeBody=Viva.Graph.svg("circle").attr("cx",0).attr("cy",0).attr("r",o).attr("fill",t.data.nodeColor).attr("stroke-width",3).attr("stroke",null==a.entityBorderColor?t.data.nodeBorderColor:a.entityBorderColor),1==a.haze&&nodeBody.attr("filter","url(#hazeEffect)"),1==a.rounded&&nodeBody.attr("fill","url(#gradRound)"),1==!a.opaque&&nodeBody.attr("fill-opacity",t.data.nodeOpacity),nodeBodyImage=Viva.Graph.svg("image").attr("x",-o).attr("y",-o).attr("rx",o).attr("width",2*o).attr("height",2*o).link(n.image?n.image:""),1==a.rounded&&nodeBodyImage.attr("fill","url(#gradRound)"),1==!a.opaque&&nodeBodyImage.attr("fill-opacity",t.data.nodeOpacity),displayText=Viva.Graph.svg("text").attr("y",0).attr("x",0).attr("fill",a.entityLabelColor).attr("stroke-width","0").attr("font-family","Arial, Helvetica, sans-serif").attr("font-size","20").text(t.data.displayLabel),popoutTextUI=Viva.Graph.svg("text").attr("class","slideText").attr("y",-o).attr("x",0).attr("fill","#0077b3").attr("stroke-width","0").attr("font-family","Arial, Helvetica, sans-serif").attr("font-size","10").text("--"),popoutTextUI.innerHTML=propertyListToSvgList(t.data.properties,'<tspan x="50" dy="1.2em">',"</tspan>"),popoutBodyUI=Viva.Graph.svg("rect").attr("class","slideout").attr("x",o/2).attr("y",-o).attr("rx",o/4).attr("height",0).attr("fill","#141414"),1==!a.opaque&&popoutBodyUI.attr("fill-opacity",.3);var r="<defs>";r+='<filter id="hazeEffect" x="-1" y="-1" width="300%" height="300%"><feOffset result="offOut" in="FillPaint" dx="0" dy="0" /><feGaussianBlur result="blurOut" in="offOut" stdDeviation="10" /><feBlend in="SourceGraphic" in2="blurOut" mode="normal" /></filter>',r+='<filter id="shadowEffect" x="-1" y="-1" width="300%" height="300%"><feOffset result="offOut" in="SourceAlpha" dx="20" dy="20" /><feGaussianBlur result="blurOut" in="offOut" stdDeviation="10" /><feBlend in="SourceGraphic" in2="blurOut" mode="normal" /></filter>',r+='<radialGradient id="gradRound" cx="50%" cy="50%" r="50%" fx="50%" fy="50%"><stop offset="80%" style="stop-color:rgb('+t.data.nodeColorRGB.r+","+t.data.nodeColorRGB.g+","+t.data.nodeColorRGB.b+'); stop-opacity:1" /><stop offset="100%" style="stop-color:rgb('+(t.data.nodeColorRGB.r-100)+","+(t.data.nodeColorRGB.g-100)+","+(t.data.nodeColorRGB.b-100)+');stop-opacity:1" /></radialGradient>',r+="</defs>",e.innerHTML=r,t.data.UI.fullUI=e,t.data.UI.bodyUI=nodeBody,t.data.UI.imageUI=nodeBodyImage,t.data.UI.displayTextUI=displayText,t.data.UI.popoutBodyUI=popoutBodyUI,t.data.UI.popoutTextUI=popoutTextUI,a.loadNodePopouts&&e.append(t.data.UI.popoutBodyUI),e.append(t.data.UI.bodyUI),n.image&&e.append(t.data.UI.imageUI),a.showLabels&&e.append(t.data.UI.displayTextUI),a.loadNodePopouts&&e.append(t.data.UI.popoutTextUI)}function defineNodeAppearance_subNode(t,e){var a=t.data.sourceConfig.displaySettings,n=t.data.config.nodeDisplayBody;n.color&&(t.data.nodeColor=n.color);var o=Number(t.data.entityConfig.config.attributes.radius);nodeBody=Viva.Graph.svg("circle").attr("cx",0).attr("cy",0).attr("r",o).attr("fill",t.data.nodeColor).attr("stroke-width",3).attr("stroke",t.data.nodeColor),nodeBodyImage=Viva.Graph.svg("image").attr("x",-o).attr("y",-o).attr("rx",o).attr("width",2*o).attr("height",2*o).link(n.image?n.image:""),a.rounded&&nodeBodyImage.attr("fill","url(#gradRound)"),a.opaque||nodeBodyImage.attr("fill-opacity",t.data.nodeOpacity),displayText=Viva.Graph.svg("text").attr("y",0).attr("x",0).attr("fill","black").attr("stroke-width","0").attr("font-family","Arial, Helvetica, sans-serif").attr("font-size","20").text(t.data.displayLabel),t.data.UI.fullUI=e,t.data.UI.bodyUI=nodeBody,t.data.UI.imageUI=nodeBodyImage,t.data.UI.displayTextUI=displayText,e.append(t.data.UI.bodyUI),n.image&&e.append(t.data.UI.imageUI),a.showLabels&&e.append(t.data.UI.displayTextUI)}function propertyType(t,e){return this.key=t,this.value=e,this.datatype=getType(e),this}function themeType(t,e,a){this.entityRgbRange=t||{min:100,max:200},this.graphBackground=e||"#1a1a1a",this.entityLabelColor=a||"white",this.opaque=!1,this.labelSizing="fontsize",this.shadow=!0,this.glow=!1,this.linkColor="red",this.rounded=!1,this.showLabels=!0}function timeoutElementType(t,e,a){this.fnRemove=a,this.duration=e,this.activationPoint=+new Date,this.element=t}function viewOptionsType(){return this.screenDragType=!0,this.highlightRelated=!0,this.highlightAncestors=!1,this.highlightdescendants=!1,this.navigateDirection="both",this}function GraphElement(){this.fromNode,this.toNode,this.link}function PropertyTypeDef(){this.DataTypes=[],this.rangeIfNumber={min:0,max:0}}function EntityTypeDef(){this.labels=[],this.properties={},this.imageProperties=[]}function Globals(){this.binaryToggle=!0,this.labelsList=[],this.nodeList=[],this.entityTypeDefs=[],this.monitoredNodes=[],this.toolPanels=[],this.monitoredLinks=[],this.animUpdateNodes=[],this.animUpdateLinks=[],this.checkedNodes=[],this.checkedLinks=[],this.linkList=[],this.timeoutElements=[],this.selectedNodeID="",this.selectedNodeData="",this.selectedNode="",this.selectedLink="",this.selectedNodeUI="",this.bRelate=!1,this.bPlanRelate=!1,this.counter=10,this.detailsUI,this.detailsNode,this.processUniqueId=0,this.nodeFunctions={},this.consoleService=new ConsoleService,this.viewOptions=new viewOptionsType,this.interactionOptions=new interactionOptionsType,this.currentTheme=new themeType,this.maxLabelLength=5,this.labelSize=30,this.CommonUI={},this.GRAPH="",this.graphics="",this.layout="",this.renderer="",this.graphContainer,this.masterConfigs=[],this.masterEntityConfigs=[],this.config_ext,this.dataService=new DataService,this.allUnitTests=[],this.Translators=[]}function createDataDriver(){return new LocalStorageDataDriver}function createDataStringHelper(){return new DataStringHelper}function createJsonParser(){return new JsonTranslator}function createConfigHelper(){return new ConfigHelper}function initializeConfiguration(t){$(document).ready(function(e){if(configManager=configManager,0!=configManager.configs.length){globals.masterConfigs=[];var a=configManager.configs[0],n=new JsonHelper;configManager.configs.map(function(t){"entity"===t.configType&&globals.masterEntityConfigs.push(t),globals.masterConfigs.push(n.MergeJson(a,t,"arrayId"))}),(new DataService).GetAllConfigs().forEach(function(t){globals.masterEntityConfigs.push(t),consoleApp.tabs.newMatching.masterEntityConfigs.push(t)});var o=document.getElementById("configSelector");globals.masterConfigs.forEach(function(t){(configManager.defaultConfig=t.prefix)&&(a=t),o.innerHTML+='<option value="'+t.configName+'">'+t.configName+"</option>"}),t(a)}else alert("Error: unable to load configurations")})}function setupCommonUI(){globals.CommonUI.focusUI=Viva.Graph.svg("circle").attr("cx",0).attr("cy",0).attr("r",50).attr("fill","transparent").attr("stroke",globals.currentTheme.sourceConfig.displaySettings.focusColor),globals.currentTheme.sourceConfig.displaySettings.opaque||globals.CommonUI.focusUI.attr("stroke-opacity","0.5"),"rect"==globals.currentTheme.sourceConfig.displaySettings.entityShape&&(globals.CommonUI.focusUI.attr("width",150),globals.CommonUI.focusUI.attr("height",100),globals.CommonUI.focusUI.attr("rx",12.5),globals.CommonUI.focusUI.attr("x",-75),globals.CommonUI.focusUI.attr("y",-50)),globals.CommonUI.linkFocusUI=Viva.Graph.svg("path").attr("stroke",globals.currentTheme.sourceConfig.displaySettings.focusColor).attr("stroke-width","5"),globals.CommonUI.checkUI=Viva.Graph.svg("circle").attr("cx",0).attr("cy",0).attr("r",50).attr("fill","transparent").attr("stroke",globals.currentTheme.sourceConfig.displaySettings.highlightColor).attr("stroke-width","5"),globals.currentTheme.sourceConfig.displaySettings.opaque||globals.CommonUI.checkUI.attr("stroke-opacity","0.5"),globals.currentTheme.sourceConfig.displaySettings.highlightHaze&&globals.CommonUI.checkUI.attr("filter","url(#hazeEffect)"),globals.CommonUI.linkMidMarker=Viva.Graph.svg("marker").attr("class","markertextmain").attr("viewBox","-4 -6 8 12").attr("refX","3").attr("refY","0.5").attr("markerWidth","500").attr("markerHeight","100").attr("markerUnits","userSpaceOnUse").attr("orient","auto"),globals.CommonUI.linkName=Viva.Graph.svg("text").attr("class","markertextlabel").attr("x","0").attr("y","0.5").attr("fill",globals.currentTheme.sourceConfig.displaySettings.linkMainTextColor).attr("font-family","Arial, Helvetica, sans-serif").attr("font-size","1.5"),globals.CommonUI.linkProps=Viva.Graph.svg("text").attr("class","markertextsub").attr("x","0").attr("y",".5").attr("fill",globals.currentTheme.sourceConfig.displaySettings.linkSubTextColor).attr("font-family","Arial, Helvetica, sans-serif").attr("font-size","1"),globals.CommonUI.popoutInfoUI=Viva.Graph.svg("g"),globals.CommonUI.popoutTextUI=Viva.Graph.svg("text").attr("y",0).attr("x",0).attr("fill",globals.currentTheme.sourceConfig.displaySettings.entityPopoutTextColor).attr("stroke-width","0").attr("font-family","Arial, Helvetica, sans-serif").attr("font-size","10").attr("opacity",0).text("--"),globals.CommonUI.popoutBodyUI=Viva.Graph.svg("rect").attr("width",0).attr("x",0).attr("y",0).attr("rx",7).attr("height",0).attr("fill",globals.currentTheme.sourceConfig.displaySettings.entityPopoutBoxColor),globals.CommonUI.popoutInfoUI.append(globals.CommonUI.popoutBodyUI),globals.CommonUI.popoutInfoUI.append(globals.CommonUI.popoutTextUI)}function graphexMain(){initializeConfiguration(function(t){var e=new ConfigHelper;e.setConfigSettings(t),e.runStartupProcedures(),setupCommonUI(),prepareGraph(),defineNodes(),defineNodeDrawing(),defineLinkObjectsCommonAssets(),defineLinkObjects(),defineLinkDrawing(),renderGraph(),initUi(),checkTimeoutElements(),window.location.href.startsWith("http://localhost:9090/")&&(new UnitTestFramework).runAllUnitTests(globals.allUnitTests);var a=new UrlHelper;a.GetAllParams().forEach(t=>{if("graph"==t.key&&(new UrlParamsTranslator).Translate(t.value),"grenc"==t.key){a.GetParameterByName("trans");var e=(new StringHelper).ReplaceEachOfCharSet(t.value,"._-","+/="),n=atob(e);(new SimpleTranslator).Translate(n)}})})}function prepareGraph(){var t=Viva.Graph.graph();globals.layout=Viva.Graph.Layout.forceDirected(t,{springLength:150,springCoeff:8e-5,springTransform:function(t,e){e.length=150}}),globals.graphics=Viva.Graph.View.svgGraphics(),globals.GRAPH=t}function defineNodes(){globals.graphics.node(function(t){return nodeOuterLayer=Viva.Graph.svg("g"),nodeLayer=Viva.Graph.svg("g"),function(t){return t.displaySettings.shadow}(t.data.sourceConfig)&&function(t){t.attr("filter","url(#shadowEffect)")}(nodeLayer),"data"==t.data.nodeType?defineNodeAppearance_dataNode(t,nodeLayer):"subnode"==t.data.nodeType?(defineNodeAppearance_subNode(t,nodeLayer),t.data.superNodes[0]&&nodeLayer.attr("parentnodeid",t.data.superNodes[0].id)):"planned"==t.data.nodeType&&defineNodeAppearance_plannedNode(t,nodeLayer),function(t,e){$(e).tap(function(e){node_Event("tap",t,e.pageX,e.pageY)}),$(e).taphold(function(e){node_Event("taphold",t,e.pageX,e.pageY)}),$(e).touchstart(function(e){node_Event("touchstart",t,e.originalEvent.touches[0].pageX,e.originalEvent.touches[0].pageY)}),$(e).touchmove(function(e){node_Event("touchmove",t,e.originalEvent.changedTouches[0].pageX,e.originalEvent.changedTouches[0].pageY)}),$(e).touchend(function(e){node_Event("touchend",t,e.originalEvent.changedTouches[0].pageX,e.originalEvent.changedTouches[0].pageY)}),$(e).mousedown(function(e){node_Event("mousedown",t,e.pageX,e.pageY)}),$(e).contextmenu(function(e){node_Event("contextmenu",t,e.pageX,e.pageY)}),$(e).mouseup(function(e){node_Event("mouseup",t,e.pageX,e.pageY)}),$(e).mouseover(function(e){node_Event("mouseover",t,e.pageX,e.pageY)}),$(e).click(function(e){node_Event("click",t,e.pageX,e.pageY)}),$(e).dblclick(function(e){node_Event("dblclick",t,e.pageX,e.pageY)}),$(e).hover(function(e){node_Event("MouseEnter",t,e.pageX,e.pageY)},function(){node_Event("MouseLeave",t,event.pageX,event.pageY)})}(t,nodeLayer),function(t,e){e.attr("depth",5),e.attr("class","node"),e.attr("nodeSize",Number(t.data.entityConfig.config.attributes.radius)),e.attr("nodeid",t.id),e.attr("dragging",!1),e.attr("nodetype",t.data.nodeType)}(t,nodeLayer),nodeOuterLayer.append(nodeLayer),t.data.UI.outerUI=nodeOuterLayer,nodeOuterLayer})}function defineNodeDrawing(){globals.graphics.placeNode(function(t,e){t.attr("transform","translate("+e.x+","+e.y+")"),"true"==t.node.data.dragging&&node_Event("MouseDragging",t.node,e.x,e.y)}),globals.graphics.translateRel=function(t,e){var a=globals.graphics.getSvgRoot(),n=globals.graphics.getGraphicsRoot().children[0],o=a.createSVGPoint(),r=n.getCTM(),i=a.createSVGPoint().matrixTransform(r.inverse());o.x=t,o.y=e,(o=o.matrixTransform(r.inverse())).x=(o.x-i.x)*r.a,o.y=(o.y-i.y)*r.d,r.e+=o.x,r.f+=o.y;var l="matrix("+r.a+", 0, 0,"+r.d+","+r.e+","+r.f+")";n.attr("transform",l),"depth"==globals.viewOptions.screenDragType&&function(t){globals.GRAPH.forEachNode(function(e,a){globals.layout.pinNode(e,!0);var n=globals.layout.getNodePosition(e.id);n.x=n.x+t.x*e.data.depth,n.y=n.y+t.y*e.data.depth,globals.layout.setNodePosition(e.id,n.x,n.y)})}({x:t,y:e}),globals.consoleService.hideNodeFlyout()}}function defineLinkObjectsCommonAssets(){var t=Viva.Graph.svg("marker").attr("id","Triangle").attr("viewBox","0 0 10 10").attr("refX","30").attr("refY","5").attr("refY","5").attr("markerUnits","userSpaceOnUse").attr("markerWidth","10").attr("markerHeight","10").attr("orient","auto"),e=Viva.Graph.svg("path").attr("d","M 0 0 L 12 5 L 0 10 z").attr("fill",globals.currentTheme.sourceConfig.displaySettings.linkColor);t.append(e);var a=Viva.Graph.svg("marker").attr("id","DoubleDash").attr("viewBox","-4 -6 8 12").attr("refX","-20").attr("refY","0").attr("markerWidth","20").attr("markerHeight","20").attr("markerUnits","userSpaceOnUse").attr("orient","auto"),n=Viva.Graph.svg("rect").attr("x","-3").attr("y","-5").attr("width","2").attr("height","10").attr("fill",globals.currentTheme.sourceConfig.displaySettings.linkColor),o=Viva.Graph.svg("rect").attr("x","1").attr("y","-5").attr("width","2").attr("height","10").attr("fill",globals.currentTheme.sourceConfig.displaySettings.linkColor);a.append(n),a.append(o);var r=globals.graphics.getSvgRoot().append("defs");r.append(t),r.append(a)}function defineLinkObjects(){globals.graphics.link(function(t){if("data"==t.data.linkType){u=t.data.id;if("all"==t.data.sourceConfig.displaySettings.showRelationships||"on-highlight"==t.data.sourceConfig.displaySettings.showRelationships){var e=Viva.Graph.svg("marker").attr("class","markertextmain").attr("id","mid"+u).attr("viewBox","-4 -6 8 12").attr("refX","0").attr("refY","0").attr("markerWidth","500").attr("markerHeight","100").attr("markerUnits","userSpaceOnUse").attr("orient","auto"),a=Viva.Graph.svg("marker").attr("id","end"+u).attr("viewBox","-4 -6 8 12").attr("refX","0").attr("refY","0").attr("markerWidth","50").attr("markerHeight","100").attr("markerUnits","userSpaceOnUse").attr("orient","auto"),n=Viva.Graph.svg("path").attr("stroke-width",0).attr("d","M 0 -0.7 L 2 0 L 0 0.7 z").attr("fill",t.data.color);t.data.sourceConfig.displaySettings.opaque||n.attr("opacity",t.data.sourceConfig.displaySettings.linkOpacity),a.append(n);var o=globals.graphics.getSvgRoot().append("defs");o.append(e),o.append(a),t.data.UI.midMarkerUI=e,t.data.UI.toMarkerUI=a}var r=Viva.Graph.svg("g").attr("class","link"),i=Viva.Graph.svg("path").attr("class","linkpath").attr("id",u).attr("stroke",t.data.color).attr("stroke-width",t.data.sourceConfig.displaySettings.linkThickness).attr("marker-mid","url(#mid"+u+")").attr("marker-end","url(#end"+u+")").attr("fill","transparent");t.data.sourceConfig.displaySettings.opaque||i.attr("stroke-opacity",t.data.sourceConfig.displaySettings.linkOpacity);var l=Viva.Graph.svg("text").attr("class","linkPoputText").attr("x",0).attr("y",0).attr("fill","#EB6A00").attr("refx","25").attr("refy","0").attr("stroke-width",0).attr("font-family","Arial, Helvetica, sans-serif").attr("font-size","10").text(""),s=0;t.data.properties.forEach(function(t){l.innerHTML+='<tspan dx="-'+s+'em" dy="1.5em" >'+t.key+": "+t.value+"</tspan>",s=5});var d=Viva.Graph.svg("rect").attr("class","linkrect").attr("refx","30").attr("width","150").attr("height","25").attr("fill","black").attr("rx","5");r.append(i),t.data.sourceConfig.displaySettings.loadRelationPopouts&&(r.append(d),r.append(l)),$(i).hover(function(){t.data.checked},function(){}),$(i).click(function(){globals.selectedLink=t,showLinkDetails(t),toggleLink(t)}),t.data.UI.fullUI=r,t.data.UI.pathUI=i,t.data.UI.popoutBodyUI=d,t.data.UI.popoutTextUI=l,"data"==t.data.linkType&&(r.attr("fromNode",t.data.fromNodeID).attr("toNode",t.data.toNodeID),r.attr("linkDataIndex",globals.linkList.length)),r.attr("fromNodeRadius",25),r.attr("toNodeRadius",25),r.attr("labelWidth",30),r.attr("labelVisible",!1)}else if("sub"==t.data.linkType){var u=t.data.id,r=Viva.Graph.svg("g").attr("class","link"),i=Viva.Graph.svg("path").attr("id",u).attr("stroke",t.data.color).attr("stroke-width","1").attr("fill","transparent");t.data.sourceConfig.displaySettings.opaque||i.attr("stroke-opacity",t.data.sourceConfig.displaySettings.linkOpacity),r.append(i),t.data.UI.fullUI=r,t.data.UI.pathUI=i,r.attr("fromNodeRadius",25),r.attr("toNodeRadius",25),r.attr("labelWidth",30),r.attr("labelVisible",!1)}else if("planned"==t.data.linkType){var u=t.data.id,r=Viva.Graph.svg("g").attr("class","link"),i=Viva.Graph.svg("path").attr("id",u).attr("stroke",t.data.color).attr("stroke-width",t.data.sourceConfig.displaySettings.linkThickness).attr("fill","transparent");t.data.sourceConfig.displaySettings.opaque||i.attr("stroke-opacity",t.data.sourceConfig.displaySettings.linkOpacity),r.append(i),t.data.UI.fullUI=r,t.data.UI.pathUI=i,r.attr("fromNodeRadius",25),r.attr("toNodeRadius",25),r.attr("labelWidth",30),r.attr("labelVisible",!1)}return r.attr("linkType",t.data.linkType),r.attr("textOrient","-1"),r.attr("linkPathIndex",0),r})}function defineLinkDrawing(){globals.graphics.placeLink(function(t,e,a){var n=t.attr("linkDataIndex"),o=t.attr("linkPos"),r=e,i=a;i.x=i.x-r.x,i.y=i.y-r.y;var l=20*o*(o%2==0?-1:1),s=i.x/2,d=i.y/2+l;t.attr("transform","translate("+e.x+","+e.y+")");for(var u=t.children[t.attr("linkPathIndex")],c=0;c<t.children.length;c++){var p=t.children[c];if(p&&(p.attr&&p.attr("refx"))){p.attr("x",s-p.attr("refx")),p.attr("y",d-p.attr("refy"));for(var g=0;g<p.children.length;g++)p.children[g]}}"true"==t.attr("labelVisible")&&(i.x>0&&("0"==t.attr("textOrient")||"-1"==t.attr("textOrient"))?(globals.linkList[Number(n)].data.UI.nameTextUI.attr("transform","scale(1,1)"),t.attr("textOrient","1")):i.x<0&&("1"==t.attr("textOrient")||"-1"==t.attr("textOrient"))&&(t.attr("textOrient","0"),globals.linkList[Number(n)].data.UI.nameTextUI.attr("transform","scale(-1,-1)")));var f,h=Math.sqrt(Math.pow(i.x,2)+Math.pow(i.y,2));if(0==o)f="M 0 0 L "+s+" "+d+" L "+i.x+","+i.y;else{var y=o*h;f="M0,0 A"+y+","+y+" 0 0,0 "+i.x+","+i.y}u.attr("d",f),u.attr("stroke-dasharray","0,0");var b=Number(t.attr("fromNodeRadius")),m=Number(t.attr("toNodeRadius"));if(0==o){var v=0;"true"==t.attr("labelVisible")&&(v=10*Number(t.attr("labelWidth")));var I=h/2-(b+5)-v/2,N=h/2-(m+10)-v/2;u.attr("stroke-dasharray","0,"+(b+5)+","+I+","+v+","+N+","+(m+10)+",0")}if(n){var T=m/6.5+2.4;globals.linkList[Number(n)]&&globals.linkList[Number(n)].data.UI.toMarkerUI.attr("refX",T)}"planned"==t.attr("linkType")&&u.attr("stroke-dasharray","5,5")})}function renderGraph(){renderer=Viva.Graph.View.renderer(globals.GRAPH,{layout:globals.layout,graphics:globals.graphics,renderLinks:!0,prerender:!0,container:document.getElementById("graphContainer")}),renderer.run()}function initUi(){globals.graphContainer=document.getElementById("graphContainer"),globals.graphContainer.style.background=globals.currentTheme.sourceConfig.displaySettings.graphBackground,null!=globals.currentTheme.sourceConfig.displaySettings.backgroundImage&&(globals.graphContainer.style["background-image"]="url("+globals.currentTheme.sourceConfig.displaySettings.backgroundImage+")"),globals.consoleService.hideNodeFlyout()}var NodeFunctionsFactory={node:{},createNew:function(t){return this.node=t,this}},UnitTestFramework=function(){this.runAllUnitTests=function(t){console.log("MEMORY",localStorage);var e=0;t.forEach(function(a){console.log("-------------------------------------------------------------------"),console.log("Test "+ ++e+"/"+t.length+', "'+a.name+'"'),function(t){var e=t();if(!0!==e)throw console.log("TEST FAILED. ACTUAL RESULT:",e),"TEST FAILED. ACTUAL RESULT: "+e;console.log("TEST PASSED")}(a)})}},SimpleTranslator=function(){function t(t,e){var a=t[0].split(u),n=a[0].trim(),o=null;if(a.length>1&&(o=a[1].trim()),function(t,e){return 0==t.length&&e}(n,o))return function(t){for(var e=0;e<d.length;e++)if(d[e].id==t)return d[e].nodes;throw"Could not find node reference: '"+u+t+`'. A '${u}ref' syntax is used to refer to an existing node, or to create a node reference. `}(o);!function(t){if(0==t.length)throw"Invalid formula. Node label is empty"}(n);var r=dataSvc.CreateEntity_AddToGraph_ReturnNode([n],e);return function(t,e){return t.length>0&&e}(n,o)&&function(t,e){for(var a=0;a<d.length;a++)if(d[a].id==t)return void null.nodes.push(e);d.push({nodes:[e],id:t})}(o,r),[r]}function e(t,e){for(var a=[],n=0;n<globals.nodeList.length;n++){for(var o=!0,r=0;r<t.length;r++)-1==globals.nodeList[n].data.labels.indexOf(t[r])&&(o=!1);if(o){var i=!0;for(var l in e)globals.nodeList[n].data.propertiesObject[l]!=e[l]&&(i=!1)}o&&i&&a.push(globals.nodeList[n])}return a}function a(t){return t.includes(c)}function n(){return!!globals.selectedNode||(alert("You must select an existing node first."),!1)}function o(t){var e=function(t){return t.split("-")[0]}(t=t.replace(c,""));if(""===e)return null;var a=r(e),n=l(e);return{labels:[a.trim()],properties:n}}function r(t){return t.split("(")[0]}function l(t){var e=t.split("(");if(e.length<2)return{};var a=e[1].trim(),n={};return a.substr(0,a.length-1).split(",").forEach(function(t){var e=t.split(":"),a=e[0].trim(),o="";e.length>1&&(o=e[1].trim()),n[a]=o}),n}var d=[],u="#",c="^";this.Name="Simply Graphex",this.Examples=["x->y",`Sam->John${c}->Bob`,"--\x3eProduct->3","Diana-MotherOf->William&Harry","Fe(name: Iron)","C(name: Carbon, weight: 12.011)","Oxygen->Hydrogen(1) & Hydrogen(2)",`Mother${u}M->Father${u}F; ${u}F->${u}M; ${u}M->Son; ${u}F->Son; Son->Grandson`,`Sun${u}S->Earth${u}E; ${u}S->Mars${u}M; ${u}E->Moon; ${u}M->Phobos;`],this.ReferenceContent=`\n\t\t\t\t\t\tType any word to create a node, eg. <span class ="inputModal code">John</span>\n\t\t\t\t\t\t<hr>\n\t\t\t\t\t\tCreate a node with some attributes, eg.\n\t\t\t\t\t\t\t</br><span class ="inputModal code">John(age: 30, sex: male)</span>\n\t\t\t\t\t\t<hr>\n\t\t\t\t\t\tCreate a relationship between two nodes:\n\t\t\t\t\t\t\t</br><span class ="inputModal code">node1->node2</span>\n\t\t\t\t\t\t<hr>\n\t\t\t\t\t\tLink multiple nodes in a chain:\n\t\t\t\t\t\t\t</br><span class ="inputModal code">n1->n2->n3->n4</span>\n\t\t\t\t\t\t<hr>\n\t\t\t\t\t\tLink multiple nodes to one node:\n\t\t\t\t\t\t\t</br><span class ="inputModal code">n1->n2 & n3 & n4</span>\n\t\t\t\t\t\t<hr>\n\t\t\t\t\t\tAlternative relationship syntax: <span class ="inputModal code">--\x3e</span>\n\t\t\t\t\t\t<hr>\n\t\t\t\t\t\tCreate relationship with a name: <span class ="inputModal code">-name-></span>\n\t\t\t\t\t\t<hr>\n\t\t\t\t\t\tCreate relationship with a name and some attributes:\n\t\t\t\t\t\t\t</br><span class ="inputModal code">-owns(since: 2010) -></span>\n\t\t\t\t\t\t<hr>\n\t\t\t\t\t\tSelect the node using the <span class ="inputModal code">${c}</span> symbol:\n\t\t\t\t\t\t\t</br><span class ="inputModal code">node1->node2 ${c}</span>\n\t\t\t\t\t\t<hr>\n            Create a temporary node reference using the <span class ="inputModal code">`+u+`</span> character:\n              </br><span class ="inputModal code">star ${u}S->planet ${u}P; ${u}S->sun; ${u}P->Earth</span>\n\n\t`,this.TranslateGraphToFormula=function(){for(var t=0;t<globals.nodeList.length;t++)for(var e=globals.nodeList[i],a=(e.properties,0);a<e.links.length;a++)e.links.length[a].properties},this.Translate=function(i){d=[];for(var u=i.split(";"),c=0;c<u.length;c++)u[c].trim().length>0&&function(i){var d=new DataService,u=i.split("->"),c=u[0].trim(),p=o(c.trim()),g=[];if(null===p){if(!n)return;g=[globals.selectedNode]}else 0==(g=e(p.labels,p.properties)).length&&(g=g.concat(t(p.labels,p.properties)),console.log("currentNodes",g)),a(c)&&highlightSelectedNode(currentNode.id);for(var f=1;f<u.length;f++){var h=u[f].trim(),y=h.split("&"),b=function(t){var e=function(t){var e=t.split("-");return e.length>1?e[1]:null}(c);if(null===e)return null;var a=r(e),n=l(e);return{labels:[a.trim()],properties:n}}();for(s=0;s<y.length;s++){var m=y[s].trim(),v=o(m),I=[];if(null===v){if(!n)return;I=[globals.selectedNode]}else 0==(I=e(v.labels,v.properties)).length&&(I=t(v.labels,v.properties)),a(m)&&I.forEach(t=>highlightSelectedNode(t.id)),applyPopoutEffectToNode(I[0],g[0].id);g.forEach(t=>{I.forEach(e=>{d.CreateRelation_AddToGraph_ReturnLink(t.id,e.id,null===b?[]:b.labels,null===b?{}:b.properties)})})}c=h,g=I}}(u[c].trim())}},sort_by=function(t,e,a){var n=a?function(e){return a(e[t])}:function(e){return e[t]};return e=e?-1:1,function(t,a){return t=n(t),a=n(a),e*((t>a)-(a>t))}},ConsoleService=function(){this.hideNodeFlyout=function(){var t=document.getElementById("panel.node");t.classList.remove("fadein"),t.classList.add("fadeout"),setTimeout(function(){t.innerHTML="",t.style.left="-100px"},200)},this.ShowFlyout=function(t,e,a){document.getElementById("panel.node");var n="";n+='<span class="header">',n+=t.data.labels.toString(),n+="</span>",n+='<span class="pull-right">',n+='\t\t<span class="winbtn">',n+="\t\t\t<i onclick=\"nodeFlyout_Event_PinClick('"+t.id+'\')" class="glyphicon glyphicon-pushpin"></i>',n+="\t\t</span>",n+="</span>",n+='<span class="pull-right">',n+='\t\t<span class="winbtn">',n+="\t\t\t<i onclick=\"nodeFlyout_Event_HideClick('"+t.id+'\')" class="glyphicon glyphicon-eye-close pull-right"></i>',n+="\t\t</span>",n+="</span>",n+="<table>",t.data.properties.forEach(function(t){n+="  <tr>",n+="    <td>",n+="      <b>&nbsp"+t.key+":&nbsp</b>",n+="    <td>",n+="    <td>",n+=t.value,n+="    <td>",n+="  <tr>"}),n+="</table>",n+="<div>",t.data.config.nodeFlyout.forEach(function(t){n+="<"+t.elementType,t.onclick&&(n+=' onclick="'+t.onclick+'"'),n+=">",n+=t.innerHTML,n+="</"+t.elementType+">"}),function(t,e,a){var n=document.getElementById("panel.node");n.classList.remove("fadein"),n.classList.add("fadeout"),setTimeout(function(){n.style.left=t+50+"px",n.style.top=e-30+"px",n.innerHTML=a,n.classList.remove("fadeout"),n.classList.add("fadein")},200)}(e,a,n+="</div>")}},HttpClient=function(){this.get=function(t,e){var a=new XMLHttpRequest;a.onreadystatechange=function(){4==a.readyState&&200==a.status&&e(a.responseText)},a.open("GET",t,!0),a.send(null)}},DataService=function(){function t(t,e,a){addEntityLabel(t,e,a);refreshEntitySelectors(),consoleApp.refreshTypeSelectors()}function e(t){return t.length>3&&"LOC"==t.substring(0,3)?t.substring(3):t}var a=new LocalStorageDataDriver;this.DropDatabase=function(){a.ClearStorage(),window.location.reload()},this.CreateConfigReturnId=function(t,e){if(a.ConfigExists(t))throw"A config by that name already exists";return a.CreateConfigInDbAndReturnId(t,e)},this.CreateUpdateConfigReturnId=function(t,e){var n=this.GetConfigByName(t);if(!n)return a.CreateConfigInDbAndReturnId(t,e);var o=(new JsonHelper).MergeJson(n,e,"arrayId");return console.log("existingConfig",n),console.log("jsonConfig",e),console.log("finalConf",o),a.UpdateConfigInDb(t,o)},this.GetAllConfigs=function(){return a.GetAllConfigNames().map(function(t){return a.GetConfigsByName(t)[0]})},this.GetConfigByName=function(t){if(!t)throw"Config name not provided";var e=a.GetConfigsByName(t);return 0==e.length?null:e[0]},this.FetchEntitiesForNodeId=function(t,n){addNodesToGraphFromGraphElementsAndReturnNodes(a.GetRelatedEntityGraph(e(t)),globals.currentTheme.sourceConfig)},this.CreateEntity_AddToGraph_ReturnNode=function(e,n,o){o||(o=globals.currentTheme.sourceConfig),n||(n={});var r={labels:e,properties:n},i=a.CreateEntityInDatabasePopulateAndReturnId(r),l=a.GetEntityById(i);return t(e[0],1,o),addEntitiesToGraphAndReturnNodes([l])[0]},this.CreateEntityReturnId=function(t,e){e||(e={});var n={labels:t,properties:e};return a.CreateEntityInDatabasePopulateAndReturnId(n)},this.DeleteEntity=function(t,e){a.DeleteEntity(t)},this.CheckMonitoredNodes=function(t){},this.CheckMonitoredLinks=function(t){},this.Qbuilder=function(t,e){},this.Qbuilder_ClearValue=function(t){},this.QuerySimpleSearch=function(t,e,a,n){},this.GetRelationCounts=function(t,e,a){},this.GetEntitiesByType=function(t,e){return addEntitiesToGraphAndReturnNodes(a.GetEntitiesByType(t),globals.currentTheme.sourceConfig)},this.GetEntityById=function(t,e){return a.GetEntityFromDatabase(t)},this.GetEntitiesByDetails=function(t,e,a){},this.GetAllEntities=function(t){a.GetAllEntityTypes().forEach(function(t){addEntitiesToGraphAndReturnNodes(a.GetEntitiesByType(t),globals.currentTheme.sourceConfig)}),this.GetAllRelations(t)},this.GetAllRelations=function(t){addNodesToGraphFromGraphElementsAndReturnNodes(a.GetAllRelationTypesAndRelationIds().map(function(t){t.ids.map(function(t){return a.GetGraphOfRelation(t)})}),globals.currentTheme.sourceConfig)},this.CreateEntityReturnCallbackWithIds=function(e,n,o){var r={labels:[e],properties:n},i=a.CreateEntityInDatabasePopulateAndReturnId(r);addEntitiesToGraphAndReturnNodes([a.GetEntityFromDatabase(i)],globals.currentTheme.sourceConfig),t(e,1,globals.currentTheme.sourceConfig)},this.UpdateEntity=function(t,e,a){},this.CreateRelation_AddToGraph_ReturnLink=function(t,n,o,r,i,l){var s=a.CreateRelationPopulateAndReturnId(e(t),e(n),o,r);return addRelationToGraphReturnLink(a.GetLinkFromDatabase(s))},this.DeleteRelationship=function(t,e){},this.DeleteLabel=function(t,e,a){},this.AddProperty=function(t,e){},this.AddLabel=function(t){},this.GetAllEntityTypes=function(e){a.GetAllEntityTypesAndEntityIds(e).forEach(function(e){var a=new DataEntity;a.labels=[e];var n=(new ConfigHelper).GetConfigForEntity(a);t(e.label,e.ids.length,n)})}},LocalStorageDataDriver=function(){function t(t){var e=localStorage.getItem(t);return null===e?(localStorage.setItem(t,1),1):(e=Number(e)+1,localStorage.setItem(t,e),e)}function e(t){return function(t){if(void 0===t||null===t||0===t)throw"Invalid config id"}(t),function(t){return v(localStorage.getItem(h(t)))}(t)}function a(t){return function(t){if(void 0===t||null===t||0===t)throw"Invalid node id"}(t),f(t)}function n(t){return function(t){if(void 0===t||null===t||0===t)throw"Invalid link id"}(t),function(t){return v(localStorage.getItem(b(t)))}(t)}function o(t,o,r){var i=new DataStringHelper,l=i.getDataString(t);if("|"==l)return[];var s=i.getDataFromDataString(l,o);if(0==s.length)return[];var d=s.split(",");if(0==d.length)return[];for(var u=[],c=0;c<d.length;c++)"node"===r&&u.push(a(d[c])),"link"===r&&u.push(n(d[c])),"config"===r&&u.push(e(d[c]));return u}function r(t){var e=localStorage.getItem(t);return(new DataStringHelper).getAllElements(e).map(function(t){return function(t){var e=t.split(":");return e.length>1?{label:e[0],ids:e[1].split(",")}:{label:e[0],ids:[]}}(t)})}function i(t){return(new DataStringHelper).getAllElements(t).map(function(t){return t.split(":")[0]})}function l(t,e){if(!e.id)throw"Missing config-id in config";localStorage.setItem(h(e.id),m(e)),c("INDEX_ON_CONFIG_NAMES",t,e.id)}function s(t){localStorage.setItem(y(t.id),m(t)),d("INDEX_ON_NODE_LABELS",t),u("INDEX_ON_NODE_PROPS",t)}function d(t,e){e.labels.forEach(function(a){c(t,a,e.id)})}function u(t,e){for(var a in e.properties)c(t,a,e.id)}function c(t,e,a){var n=localStorage.getItem(t),o=new DataStringHelper;null===n&&(n=o.getNewDataString()),n=o.ensureDataIntoElement(n,e,a),localStorage.setItem(t,n)}function p(t){return void 0===t&&(t=[]),t}function g(t){return void 0===t&&(t=[]),t}function f(t){return v(localStorage.getItem(y(t)))}function h(t){return"C_"+t}function y(t){return"N_"+t}function b(t){return"L_"+t}function m(t){return JSON.stringify(t)}function v(t){return JSON.parse(t)}this.ClearStorage=function(){localStorage.clear()},this.UpdateConfigInDb=function(t,e){return l(t,e),e.id},this.CreateConfigInDbAndReturnId=function(t,e){return e.id=this.GetNextNewConfigId(),l(t,e),e.id},this.CreateEntityInDatabasePopulateAndReturnId=function(t){return t=function(t){return void 0===t&&(t={}),t.labels=p(t.labels),t.links=function(t){return void 0===t&&(t=[]),t}(t.links),t.properties=g(t.properties),t}(t),t.id=this.GetNextNewEntityId(),s(t),t.id},this.GetRelatedNodes=function(t){var e=this,a=[];return this.GetEntityFromDatabase(t).links.forEach(function(n){var o=e.GetLinkFromDatabase(n);t==o.fromNodeId?a.push(o.toNodeId):a.push(o.fromNodeId)}),a},this.GetEntityById=function(t){return this.GetEntityFromDatabase(t)},this.GetConfigById=function(t){return this.GetConfigFromDatabase(t)},this.GetRelatedEntityGraph=function(t){var e=this;return this.GetEntityFromDatabase(t).links.map(function(t){return e.GetGraphOfRelation(t)})},this.GetGraphOfRelation=function(t){var e=this.GetLinkFromDatabase(t),a=new GraphElement;return a.fromNode=this.GetEntityFromDatabase(e.fromNodeId),a.toNode=this.GetEntityFromDatabase(e.toNodeId),a.link=e,a},this.CreateRelationPopulateAndReturnId=function(t,e,a,n){link={},link.id=this.GetNextNewRelationId(),link.fromNodeId=t,link.toNodeId=e,link.labels=a||[],link.properties=n||{};var o=this.GetEntityFromDatabase(t);o.links.push(link.id),s(o);var r=this.GetEntityFromDatabase(e);return r.links.push(link.id),s(r),function(t){localStorage.setItem(b(t.id),m(t)),d("INDEX_ON_LINK_LABELS",t),u("INDEX_ON_LINK_PROPS",t)}(link),link.id},this.GetConfigFromDatabase=function(t){return e(t)},this.GetEntityFromDatabase=function(t){return a(t)},this.GetLinkFromDatabase=function(t){return n(t)},this.DeleteEntity=function(t){localStorage.removeItem(y(t))},this.EntityExists=function(t){return null!==f(t)},this.GetNextNewConfigId=function(){return t("NEXT_CONFIG_ID")},this.GetNextNewEntityId=function(){return t("NEXT_NODE_ID")},this.GetNextNewRelationId=function(){return t("NEXT_LINK_ID")},this.ConfigExists=function(t){return o("INDEX_ON_CONFIG_NAMES",t,"config").length>0},this.GetConfigsByName=function(t){return o("INDEX_ON_CONFIG_NAMES",t,"config")},this.GetEntitiesByType=function(t){return o("INDEX_ON_NODE_LABELS",t,"node")},this.GetEntitiesByPropertyName=function(t){return o("INDEX_ON_NODE_PROPS",t,"node")},this.GetRelationsByLabel=function(t){return o("INDEX_ON_LINK_LABELS",t,"link")},this.GetRelationsByPropertyName=function(t){return o("INDEX_ON_LINK_PROPS",t,"link")},this.GetAllEntityTypes=function(){return i(localStorage.getItem("INDEX_ON_NODE_LABELS"))},this.GetAllRelationTypes=function(){return i(localStorage.getItem("INDEX_ON_LINK_LABELS"))},this.GetAllConfigNames=function(){return i(localStorage.getItem("INDEX_ON_CONFIG_NAMES"))},this.GetAllEntityTypesAndEntityIds=function(){return r("INDEX_ON_NODE_LABELS")},this.GetAllRelationTypesAndRelationIds=function(){return r("INDEX_ON_LINK_LABELS")}},DataStringHelper=function(){function t(t){return!function(t){return t%1>0}(t)}function e(t,e,a,n){return e+n.indexOfElementInDataString(function(t,e){return t.slice(e)}(t,e),a)}function a(t,e,a,n){return n.indexOfElementInDataString(function(t,e){return t.slice(0,e+1)}(t,e),a)}function n(t,e,a){for(var n=e,r=0;!o(a,t[n])&&n<t.length;){if(++r>1e5)throw"Overflow";n++}if(n>=t.length)throw'Missing separator in index in string: "'+t+'", starting from index: '+e;return n}function o(t,e){for(var a=0;a<t.length;a++)if(t[a]===e)return!0;return!1}this.getNewDataString=function(){return"|"},this.indexOfElementInDataString=function(t,r){if(function(t){if(!t||null===t||"|"!==t[0]||"|"!==t[t.length-1]||0===t.length||"||"==t)throw"Invalid data-string"}(t),"|"==t)return 1.1;for(var i=function(t,e,a){for(var n=e,r=0;!o(a,t[n])&&n>=-1;){if(++r>1e5)throw"Overflow";n--}if(-1===n)throw"Missing separator in index";return n}(t,function(t){return Math.floor(t.length/2)}(t),["|"]),l=n(t,i+1,[":","|"]),s=n(t,i+1,["|"]),d=t.slice(i+1,l),u=0;u<Math.min(r.length,d.length);u++){if(function(t,e){return t.charCodeAt(0)<e.charCodeAt(0)}(r[u],d[u]))return a(t,i,r,this);if(function(t,e){return t.charCodeAt(0)>e.charCodeAt(0)}(r[u],d[u]))return e(t,s,r,this)}return function(t,e){return t===e}(r,d)?i+1:function(t,e){return t.length>e.length}(r,d)?e(t,s,r,this):function(t,e){return t.length<e.length}(r,d)?a(t,i,r,this):void 0},this.getWordAtIndex=function(t,e){return t.slice(e,n(t,e,["|"]))},this.insertElementIntoDataString=function(e,a){var n=this.indexOfElementInDataString(e,a);if(!t(n)){var o=Math.trunc(n);return e.slice(0,o)+a+"|"+e.slice(o)}},this.numberBinarySearch=function(t,e){if(0===t.length)return 0;var a=Math.floor(t.length/2);return t[a]===e?a:e>t[a]?a+1+this.numberBinarySearch(t.slice(a+1),e):this.numberBinarySearch(t.slice(0,a-1),e)},this.deleteElementFromDataString=function(e,a){var o=this.indexOfElementInDataString(e,a);if(t(o))var r=Math.trunc(o),i=n(e,r,["|"]),e=e.slice(0,r-1)+e.slice(i);return e},this.getDataString=function(t){var e=localStorage.getItem(t);return e&&null!=e||(e="|"),e},this.getDataFromDataString=function(e,a){var o=this.indexOfElementInDataString(e,a);if(t(o)){var r=function(t,e){var a=n(t,e,["|"]);return t.slice(e,a)}(e,o).split(":");return r.length>1?r[1]:void 0}return""},this.replaceDataInElement=function(e,a,o){var r=this.indexOfElementInDataString(e,a);if(t(r))var i=n(e,r,[":","|"]),l=n(e,i,["|"]),e=e.slice(0,i)+":"+o+e.slice(l);else e=this.insertElementIntoDataString(e,a+":"+o);return e},this.ensureDataIntoElement=function(e,a,o){var r=this.indexOfElementInDataString(e,a);if(t(r))var i=n(e,r,[":","|"]),l=n(e,i,["|"]),s=function(t,e){var a=t.split(",");return function(t,e){return t.indexOf(e)>-1}(a,e.toString())?t:(a.push(e),a.join())}(e.slice(i+1,l),o),e=e.slice(0,i)+":"+s+e.slice(l);else{var d=a;void 0!=o&&(d=d+":"+o),e=this.insertElementIntoDataString(e,d)}return e},this.ensureDataNotInElement=function(e,a,o){var r=this.indexOfElementInDataString(e,a);if(t(r))var i=n(e,r,[":","|"]),l=n(e,i,["|"]),s=function(t,e){var a=t.split(","),n=a.indexOf(e.toString());return-1==n?t:(a=a.splice(n-1,1)).join()}(e.slice(i+1,l),o),e=e.slice(0,i)+":"+s+e.slice(l);return e},this.clearElementData=function(e,a,o){var r=this.indexOfElementInDataString(e,a);if(t(r))var i=n(e,r,[":","|"]),l=n(e,i,["|"]),e=e.slice(0,i)+e.slice(l);return e},this.getAllElements=function(t){if(!t||null==t)return[];var e=t.split("|");return e.splice(1,e.length-2)}},EventsHelper=function(t){this.distancePassedThreshold=function(t){}};NodeFunctionsFactory.show_addWorkflowModal=function(){document.getElementById("newWorkflowModel").showModal()},NodeFunctionsFactory.show_updateWorkflowModal=function(){document.getElementById("updateWorkflowModel").showModal()},NodeFunctionsFactory.show_removeWorkflowModal=function(){document.getElementById("removeWorkflowModel").showModal()},NodeFunctionsFactory.show_addContentModal=function(){document.getElementById("addContentModal").showModal()},NodeFunctionsFactory.show_updateContentModal=function(){document.getElementById("updateContent").showModal()},NodeFunctionsFactory.show_removeContentModal=function(){document.getElementById("removeContent").showModal()},NodeFunctionsFactory.show_addToolModal=function(){document.getElementById("addToolModal").showModal()},NodeFunctionsFactory.show_updateToolModal=function(){document.getElementById("updateToolModal").showModal()},NodeFunctionsFactory.show_removeToolModal=function(){document.getElementById("removeToolModal").showModal()},NodeFunctionsFactory.show_addCollectorModal=function(){document.getElementById("addCollectorModal").showModal()},NodeFunctionsFactory.show_updateCollectorModal=function(){document.getElementById("updateCollectorModal").showModal()},NodeFunctionsFactory.show_removeCollectorModal=function(){document.getElementById("removeCollectorModal").showModal()},NodeFunctionsFactory.add_workflow=function(){var t=document.getElementById("newWorkflowModel"),e=t.children[0].children[3].value,a=[];a.push({key:"workflowName",value:parseDataType(e,"string")}),createChildNode(this.node.id,"WORKFLOW",a,"SEND_TO",[]),t.close()},NodeFunctionsFactory.update_workflow=function(){var t=document.getElementById("updateWorkflowModel"),e=t.children[0].children[3].value;console.log("update_workflow for node:",this.node),this.node.data.properties.forEach(function(t){(t.key="workflowName")&&(t.value=e)});globals.dataService.UpdateEntity(this.node.id,this.node.data.properties,function(){Alert("Update applied")}),t.close()},NodeFunctionsFactory.remove_workflow=function(){globals.dataService.GetRelatedEntityGraph(this.node.id),modal.close()},NodeFunctionsFactory.add_tool=function(){var t=document.getElementById("addToolModal"),e=t.children[0].children[3].value,a=[];a.push({key:"toolName",value:parseDataType(e,"string")}),createChildNode(this.node.id,"TOOL",a,"SEND_TO",[]),t.close()},NodeFunctionsFactory.update_tool=function(){var t=document.getElementById("updateToolModel"),e=t.children[0].children[3].value;this.node.data.properties.forEach(function(t){(t.key="toolName")&&(t.value=e)});globals.dataService.UpdateEntity(this.node.id,this.node.data.properties,function(){Alert("Update applied")}),t.close()},NodeFunctionsFactory.remove_entity=function(){globals.dataService.GetRelatedEntityGraph(this.node.id),modal.close()};var globals=new Globals;globals.allUnitTests.push(function(){var t=createDataDriver();localStorage.removeItem("NEXT_NODE_ID");return 1===t.GetNextNewEntityId()||1}),globals.allUnitTests.push(function(){var t=createDataDriver();localStorage.removeItem("NEXT_LINK_ID");return 1===t.GetNextNewRelationId()||1}),globals.allUnitTests.push(function(){return void 0!==createDataDriver().CreateEntityInDatabasePopulateAndReturnId()||result}),globals.allUnitTests.push(function(){return void 0!==createDataDriver().CreateEntityInDatabasePopulateAndReturnId({})||result}),globals.allUnitTests.push(function(){var t=createDataDriver(),e=t.CreateEntityInDatabasePopulateAndReturnId({}),a=t.GetEntityFromDatabase(e);return a.id===e||a}),globals.allUnitTests.push(function(){var t=createDataDriver(),e={};t.CreateEntityInDatabasePopulateAndReturnId(e),t.CreateEntityInDatabasePopulateAndReturnId({});var a=t.GetEntityFromDatabase(e.id);return a.id===e.id||a}),globals.allUnitTests.push(function(){var t=createDataDriver(),e={labels:["label1"]};t.CreateEntityInDatabasePopulateAndReturnId(e);for(var a=t.GetEntityFromDatabase(e.id),n=0;n<e.labels.length;n++)if(e.labels[n]!==a.labels[n])return a;return!0}),globals.allUnitTests.push(function(){var t=createDataDriver(),e={labels:["label1","label2"]};t.CreateEntityInDatabasePopulateAndReturnId(e);for(var a=t.GetEntityFromDatabase(e.id),n=0;n<e.labels.length;n++)if(e.labels[n]!==a.labels[n])return a;return!0}),globals.allUnitTests.push(function(){var t=createDataDriver(),e={};t.CreateEntityInDatabasePopulateAndReturnId(e);var a=t.GetEntityFromDatabase(e.id);return!(a.labels.length>0)||a}),globals.allUnitTests.push(function(){var t=createDataDriver(),e={};t.CreateEntityInDatabasePopulateAndReturnId(e);var a=t.GetEntityFromDatabase(e.id);return!(a.properties.length>0)||a}),globals.allUnitTests.push(function(){var t=createDataDriver(),e={properties:{property1:"MyPropertyValue"}};t.CreateEntityInDatabasePopulateAndReturnId(e);var a=t.GetEntityFromDatabase(e.id);return"MyPropertyValue"===a.properties.property1||a}),globals.allUnitTests.push(function(){var t=createDataDriver(),e={properties:{property1:23}};t.CreateEntityInDatabasePopulateAndReturnId(e);var a=t.GetEntityFromDatabase(e.id);return 23===a.properties.property1||a}),globals.allUnitTests.push(function(){var t=createDataDriver(),e={properties:{property1:!0}};t.CreateEntityInDatabasePopulateAndReturnId(e);var a=t.GetEntityFromDatabase(e.id);return!0===a.properties.property1||a}),globals.allUnitTests.push(function(){var t=createDataDriver(),e={properties:{property1:["test1","test2"]}};t.CreateEntityInDatabasePopulateAndReturnId(e);var a=t.GetEntityFromDatabase(e.id);if(void 0===a.properties.property1)return a;for(var n=0;n<a.properties.property1.length;n++)if("test1"!==a.properties.property1[n]&&"test2"!==a.properties.property1[n])return a;return!0}),globals.allUnitTests.push(function(){var t=createDataDriver(),e={labels:["WORKFLOW","TOOL"],properties:{toolName:"EXCEL",property1:"string test",property2:25,property3:!0,property4:["test1","test2"]}};t.CreateEntityInDatabasePopulateAndReturnId(e);var a=t.GetEntityFromDatabase(e.id);if(void 0===a.properties.property1||void 0===a.properties.property2||void 0===a.properties.property3||void 0===a.properties.property4)return a;if(a.labels===[])return a;if(2!==a.labels.length)return a;if("string test"!==a.properties.property1)return a;if(25!==a.properties.property2)return a;if(!0!==a.properties.property3)return a;for(var n=0;n<a.properties.property4.length;n++)if("test1"!==a.properties.property4[n]&&"test2"!==a.properties.property4[n])return a;return!0}),globals.allUnitTests.push(function(){var t=createDataDriver(),e=t.CreateEntityInDatabasePopulateAndReturnId({}),a=t.CreateEntityInDatabasePopulateAndReturnId({}),n=t.CreateRelationPopulateAndReturnId(e,a);return n>0||n}),globals.allUnitTests.push(function(){var t=createDataDriver(),e={},a=t.CreateEntityInDatabasePopulateAndReturnId({}),n=t.CreateEntityInDatabasePopulateAndReturnId(e),o=t.CreateEntityInDatabasePopulateAndReturnId(e);t.CreateRelationPopulateAndReturnId(a,n);var r=t.CreateRelationPopulateAndReturnId(n,o);return!(void 0===r||r<=0)||r}),globals.allUnitTests.push(function(){var t=createDataDriver(),e=t.CreateEntityInDatabasePopulateAndReturnId({}),a=t.CreateEntityInDatabasePopulateAndReturnId({});t.CreateRelationPopulateAndReturnId(e,a);var n=t.GetRelatedNodes(e);return n[0]===a||n}),globals.allUnitTests.push(function(){var t=createDataDriver(),e=t.CreateEntityInDatabasePopulateAndReturnId({}),a=t.CreateEntityInDatabasePopulateAndReturnId({}),n=t.CreateRelationPopulateAndReturnId(e,a),o=t.GetRelatedEntityGraph(e);return o[0].fromNode.id!==e?o:o[0].toNode.id!==a?o:o[0].link.id===n||o}),globals.allUnitTests.push(function(){var t=createDataDriver(),e=t.CreateEntityInDatabasePopulateAndReturnId({}),a=t.CreateEntityInDatabasePopulateAndReturnId({}),n=t.CreateRelationPopulateAndReturnId(e,a),o=t.GetRelatedEntityGraph(e);return o[0].fromNode.id!==e?o:o[0].toNode.id!==a?o:o[0].link.id===n||o}),globals.allUnitTests.push(function(){var t=createDataDriver(),e={},a={};e.labels=["HELLO"],a.labels=["WORLD"];var n=t.CreateEntityInDatabasePopulateAndReturnId(e),o=t.CreateEntityInDatabasePopulateAndReturnId(a);t.CreateRelationPopulateAndReturnId(n,o);return addNodesToGraphFromGraphElementsAndReturnNodes(t.GetRelatedEntityGraph(n),globals.currentTheme.sourceConfig),!0}),globals.allUnitTests.push(function(){var t=createDataDriver(),e={},a={};e={labels:["WORKFLOW"],properties:{workflowName:"Transform"}},a={labels:["TOOL"],properties:{toolName:"WORD"}};var n=t.CreateEntityInDatabasePopulateAndReturnId(e),o=t.CreateEntityInDatabasePopulateAndReturnId(a);t.CreateRelationPopulateAndReturnId(n,o);return addNodesToGraphFromGraphElementsAndReturnNodes(t.GetRelatedEntityGraph(n),globals.currentTheme.sourceConfig),!0}),globals.allUnitTests.push(function(){var t=createDataDriver(),e={},a={};e.labels=["PARENT"],a.labels=["CHILD"];var n=t.CreateEntityInDatabasePopulateAndReturnId(e),o=t.CreateEntityInDatabasePopulateAndReturnId(a);t.CreateRelationPopulateAndReturnId(n,o,["MOTHER_OF"],{BirthType:"Natural Born",property3:!0,Activities:["Dancing","Hockey"]});return addNodesToGraphFromGraphElementsAndReturnNodes(t.GetRelatedEntityGraph(n),globals.currentTheme.sourceConfig),!0}),globals.allUnitTests.push(function(){var t=createDataDriver(),e={},a={};e.labels=["CASE1"],a.labels=["CASE2"];var n=t.CreateEntityInDatabasePopulateAndReturnId(e),o=t.CreateEntityInDatabasePopulateAndReturnId(a);t.CreateRelationPopulateAndReturnId(n,o);return addNodesToGraphFromGraphElementsAndReturnNodes(t.GetRelatedEntityGraph(n),globals.currentTheme.sourceConfig),!0}),globals.allUnitTests.push(function(){var t=createDataDriver(),e=t.CreateEntityInDatabasePopulateAndReturnId({});t.DeleteEntity(e);var a=t.EntityExists(e);return!1===a||a}),globals.allUnitTests.push(function(){var t=createDataStringHelper().getNewDataString();return"|"===t||t}),globals.allUnitTests.push(function(){for(var t=createDataStringHelper(),e=[],a=0;a<100;a++)e.push(a);var n=t.numberBinarySearch(e,33);return 33===n||n}),globals.allUnitTests.push(function(){for(var t=createDataStringHelper(),e=[],a=0;a<100;a++)e.push(a);var n=t.numberBinarySearch(e,34);return 34===n||n}),globals.allUnitTests.push(function(){for(var t=createDataStringHelper(),e=[],a=0;a<100;a++)e.push(a);var n=t.numberBinarySearch(e,35);return 35===n||n}),globals.allUnitTests.push(function(){for(var t=createDataStringHelper(),e=[],a=0;a<1;a++)e.push(a);var n=t.numberBinarySearch(e,1);return 1===n||n}),globals.allUnitTests.push(function(){var t=createDataStringHelper(),e="|ABC:12,|DEF|GHIJKL|MNO|PQR|STU|VWX|YZ|",a=t.indexOfElementInDataString(e,"PQR"),n=t.getWordAtIndex(e,a);return"PQR"===n||n}),globals.allUnitTests.push(function(){var t=createDataStringHelper().indexOfElementInDataString("|A|","TEST");return 3.1===t||t}),globals.allUnitTests.push(function(){var t=createDataStringHelper().indexOfElementInDataString("|","TEST");return 1.1===t||t}),globals.allUnitTests.push(function(){var t=createDataStringHelper(),e="|ABC:12,|DEF|GHIJKL|MNO|PQA|PQB|PQC|PQD|PQE|PQR|STU|VWX|YZ|",a=t.indexOfElementInDataString(e,"PQC"),n=t.getWordAtIndex(e,a);return"PQC"===n||n}),globals.allUnitTests.push(function(){var t=createDataStringHelper().indexOfElementInDataString("|ABC:12,32|DEF:12|GHIJKL|MNO:1|PQA:2|PQE:2234345|PQR:2|STU:12|VWX:0|YZ:3|","PQF");return 49.1===t||t}),globals.allUnitTests.push(function(){var t=createDataStringHelper().indexOfElementInDataString("|ABC:12,32|DEF:12|GHIJKL|MNO:1|PQA:2|PQE:23|PQR:2|STU:12|VWX:0|YZ:3|","PQRR");return 50.1===t||t}),globals.allUnitTests.push(function(){for(var t=createDataStringHelper(),e="|ABC:12,32|DEF:12|GHIJKL|MNO:1|PQA:2|PQE:23|PQR:2|STU:12|VWX:0|YZ:3|",a=!1,n=e.split("|"),o=1;o<n.length-1;o++){var r=n[o].split(":")[0],i=e.indexOf(n[o]);console.log(" - Test Case "+o+"/"+(n.length-2)+": ("+r+", "+i+")");var l=t.indexOfElementInDataString(e,r);l!==i&&(console.log("     FAILED: expected = "+i+", actual = "+l),a=!0)}return!a}),globals.allUnitTests.push(function(){for(var t=createDataStringHelper(),e="|ABC:12,32|DEF:12|GHIJKL|MNO:1|PQA:2|PQE:23|PQR:2|STU:12|VWX:0|YZ:3|",a=!1,n=e.split("|"),o=1;o<n.length-1;o++){var r=n[o].split(":")[0]+"XY",i=e.indexOf(n[o])+n[o].length+1+.1;console.log(" - Test Case "+o+"/"+(n.length-2)+": ("+r+", "+i+")");var l=t.indexOfElementInDataString(e,r);l!==i&&(console.log("     FAILED: expected = "+i+", actual = "+l),a=!0)}return!a}),globals.allUnitTests.push(function(){for(var t=createDataStringHelper(),e="|ABC:12,32|DEF:12|GHIJKL|MNO:1|PQA:2|STU:12|VWX:0|YZ:3|",a=!1,n=e.split("|"),o=1;o<n.length-1;o++){var r=n[o].split(":")[0].slice(0,-1),i=e.indexOf(n[o])+.1;console.log(" - Test Case "+o+"/"+(n.length-2)+": ("+r+", "+i+")");var l=t.indexOfElementInDataString(e,r);l!==i&&(console.log("     FAILED: expected = "+i+", actual = "+l),a=!0)}return!a}),globals.allUnitTests.push(function(){var t=createDataStringHelper().insertElementIntoDataString("|","ABC");return"|ABC|"===t||t}),globals.allUnitTests.push(function(){var t=createDataStringHelper(),e="|";return e=t.insertElementIntoDataString(e,"ABC"),e=t.insertElementIntoDataString(e,"GHI"),"|ABC|DEF|GHI|"===(e=t.insertElementIntoDataString(e,"DEF"))||e}),globals.allUnitTests.push(function(){var t=createDataStringHelper(),e="|";return e=t.insertElementIntoDataString(e,"ABC"),e=t.insertElementIntoDataString(e,"GHI"),e=t.insertElementIntoDataString(e,"DEF"),"|ABC|GHI|"===(e=t.deleteElementFromDataString(e,"DEF"))||e}),globals.allUnitTests.push(function(){var t=createDataStringHelper(),e="|";return e=t.insertElementIntoDataString(e,"ABC"),e=t.insertElementIntoDataString(e,"GHI"),e=t.insertElementIntoDataString(e,"DEF"),"|ABC|DEF|GHI|"===(e=t.deleteElementFromDataString(e,"HIJ"))||e}),globals.allUnitTests.push(function(){var t="|";return"|"===(t=createDataStringHelper().deleteElementFromDataString(t,"ABC"))||t}),globals.allUnitTests.push(function(){for(var t=createDataStringHelper(),e="|ABC:12,32|DEF:12|GHIJKL|MNO:1|PQA:2|STU:12|VWX:0|YZ:3|",a=!1,n=e.split("|"),o=1;o<n.length-1;o++){var r=n[o].split(":")[0];console.log(" - Test Case "+o+"/"+(n.length-2)+": (removing: "+r+", from: "+e+")"),(e=t.deleteElementFromDataString(e,r)).indexOf(r)>-1&&(console.log("     FAILED: actual = "+e),a=!0)}return"|"!=e?e:!a}),globals.allUnitTests.push(function(){var t=createDataStringHelper().getDataFromDataString("|ABC:13,32|DEF:12|GHIJKL|MNO:1|PQA:2|STU:45|VWX:0|YZ:3|","STU");return"45"===t||t}),globals.allUnitTests.push(function(){for(var t=createDataStringHelper(),e="|ABC:12,32|DEF:12|GHIJKL|MNO:1|PQA:2|STU:12|VWX:0|YZ:3|",a=!1,n=e.split("|"),o=1;o<n.length-1;o++){var r=n[o].split(":")[0],i=n[o].split(":")[1];console.log(" - Test Case "+o+"/"+(n.length-2)+": (get: "+r+", expect: "+i+")"),t.getDataFromDataString(e,r)!==i&&(console.log("     FAILED: actual = "+e),a=!0)}return!a}),globals.allUnitTests.push(function(){var t=createDataStringHelper().replaceDataInElement("|ABC:13,32|DEF:12|GHIJKL|MNO:1|PQA:2|STU:45|VWX:0|YZ:3|","STU","67");return"|ABC:13,32|DEF:12|GHIJKL|MNO:1|PQA:2|STU:67|VWX:0|YZ:3|"===t||t}),globals.allUnitTests.push(function(){var t=createDataStringHelper().replaceDataInElement("|ABC:13,32|DEF:12|GHIJKL|MN:1|PQA:2|STU:45|VWX:0|YZ:3|","OOO","35");return"|ABC:13,32|DEF:12|GHIJKL|MN:1|OOO:35|PQA:2|STU:45|VWX:0|YZ:3|"===t||t}),globals.allUnitTests.push(function(){var t=createDataStringHelper().replaceDataInElement("|","OOO","35");return"|OOO:35|"===t||t}),globals.allUnitTests.push(function(){var t=createDataStringHelper().ensureDataIntoElement("|ABC:13,32|DEF:12|GHIJKL|MN:1|PQA:2|STU:45|VWX:0|YZ:3|","MN","35");return"|ABC:13,32|DEF:12|GHIJKL|MN:1,35|PQA:2|STU:45|VWX:0|YZ:3|"===t||t}),globals.allUnitTests.push(function(){var t=createDataStringHelper().ensureDataNotInElement("|ABC:13,32|DEF:12|GHIJKL|MN:1,35|PQA:2|STU:45|VWX:0|YZ:3|","MN","1");return"|ABC:13,32|DEF:12|GHIJKL|MN:35|PQA:2|STU:45|VWX:0|YZ:3|"===t||t}),globals.allUnitTests.push(function(){var t=createDataStringHelper().clearElementData("|ABC:13,32|DEF:12|GHIJKL|MN:1|PQA:2|STU:45|VWX:0|YZ:3|","ABC");return"|ABC|DEF:12|GHIJKL|MN:1|PQA:2|STU:45|VWX:0|YZ:3|"===t||t}),globals.allUnitTests.push(function(){var t=createDataStringHelper().getAllElements("|ABC:13,32|DEF:12|GHIJKL|MN:1|PQA:2|STU:45|VWX:0|YZ:3|");return 8===t.length||t}),globals.allUnitTests.push(function(){var t=createDataDriver(),e=t.CreateEntityInDatabasePopulateAndReturnId({labels:["FindMe"]}),a=t.GetEntitiesByType("FindMe");return a[0].id===e||a}),globals.allUnitTests.push(function(){var t=createDataDriver(),e=t.CreateEntityInDatabasePopulateAndReturnId({labels:["ATOM"],properties:{element:"Hydrogen"}}),a=t.CreateEntityInDatabasePopulateAndReturnId({labels:["ATOM"],properties:{element:"Oxygen"}}),n=t.CreateEntityInDatabasePopulateAndReturnId({labels:["ATOM"],properties:{element:"Helium"}}),o=t.CreateRelationPopulateAndReturnId(e,a,["BOND"],{strength:"strong"}),r=t.CreateRelationPopulateAndReturnId(a,n,["BOND"],{strength:"strong"}),i=t.GetRelationsByLabel("BOND");return i[0].id===o&&i[1].id===r||i}),globals.allUnitTests.push(function(){var t=createDataDriver();t.CreateEntityInDatabasePopulateAndReturnId({labels:["ThisTestLabel0"]}),t.CreateEntityInDatabasePopulateAndReturnId({labels:["ThisTestLabel2","ThisTestLabel1"]}),t.CreateEntityInDatabasePopulateAndReturnId({labels:["ThisTestLabel3"]});var e=t.GetAllEntityTypes();return e.indexOf("ThisTestLabel1")>-1&&e.indexOf("ThisTestLabel2")>-1||e}),globals.allUnitTests.push(function(){var t=createDataDriver(),e=t.CreateEntityInDatabasePopulateAndReturnId({labels:["PropsNodeTest"],properties:{uniqueProp1672:"uniqueProperty",prop2:"value2"}}),a=t.GetEntitiesByPropertyName("uniqueProp1672");return a[0].id==e||a}),globals.allUnitTests.push(function(){var t=createDataDriver(),e={},a={};e.labels=["CLIENT"],a.labels=["CAR"],a.properties={Manufacturer:"Kia",Model:"Picanto"},linkLabels=["OWNS"],linkProperties={uniqueProp1673:"ForAlink",Year:2012,Dealer:"Autocar",OnLayby:!0,AttendedBy:["Joan Luna","Derick Stapler"]};var n=t.CreateEntityInDatabasePopulateAndReturnId(e),o=t.CreateEntityInDatabasePopulateAndReturnId(a),r=t.CreateRelationPopulateAndReturnId(n,o,linkLabels,linkProperties);return t.GetRelationsByPropertyName("uniqueProp1673")[0].id==r||resultNodes}),globals.allUnitTests.push(function(){var t=createJsonParser().TranslateToGraph_ReturnGraphElements("root",JSON.stringify({Parent:{Name:"John",Child:[{Name:"Scott",Age:10},{Name:"Jane"}]}}),globals.currentTheme.sourceConfig);return 2==t.length&&"Parent"==t[0].fromNode.data.labels[0]||t}),globals.allUnitTests.push(function(){var t=new DataService,e={configName:"TestConfig1",configType:"entity",matchEntity:{labels:["HELLO"]},config:{attributes:{"background-color":"#33c11d","border-color":"#334687",circleText:{color:"#00FF00"},img:{url:"custom/assets/Space/Earth-PNG-Clipart.png",width:70,height:70}}}},a=(globals.masterConfigs.forEach(function(t){if("BNC"==t.prefix)return t}),t.CreateUpdateConfigReturnId("TestConfig1",e),t.GetConfigByName("TestConfig1"));return"#00FF00"===a.config.attributes.circleText.color||a}),globals.allUnitTests.push(function(){var t=createConfigHelper(),e=new DataService,a={labels:["EntityForConfig"],properties:{id:"MyId121",prop2:"value2"}},n=e.CreateEntityReturnId(a.labels,a.properties),o={configName:"TestConfig2",configType:"entity",matchEntity:{labels:["EntityForConfig"]},config:{attributes:{"background-color":"#f2b3ab",circleText:{color:"#6fa563"}},relatedThings:[{thingName:"option",url:"custom/assets/64.png",x:10,y:-50,size:50}]}},r=(t.AddDynamicEntityConfigReturnId("TestConfig2",o),addEntitiesToGraphAndReturnNodes([a=e.GetEntityById(n)]),t.GetConfigForEntityId(n));return"#6fa563"==r.config.attributes.circleText.color||r}),globals.allUnitTests.push(function(){var t=new DataService,e={labels:["CASE2"]},a={configName:"TestConfig3",configType:"entity",matchEntity:e,config:{attributes:{"background-color":"#33c11d","border-color":"#4155f4",circleText:{color:"#0000FF"}}}},n=(t.CreateUpdateConfigReturnId("TestConfig3",a),{configName:"TestConfig3",configType:"entity",matchEntity:e,config:{attributes:{radius:15,"background-color":"#33c11d","border-color":"#4155f4",circleText:{color:"#FF0000"}}}}),o=(t.CreateUpdateConfigReturnId("TestConfig3",n),t.GetConfigByName("TestConfig3"));return"#FF0000"===o.config.attributes.circleText.color&&15===o.config.attributes.radius||o}),globals.allUnitTests.push(function(){var t=(new JsonTranslator).Translate('{\n      "level1String": "level1String",\n      "level1Object": {\n        "level2String": "level2String",\n        "level2Object": {\n          "level3String": "level3String",\n          "level3Array": [\n            {\n              "arrayId": "0",\n              "level4ElementString": "level4ElementString_BaseObjectOnly"\n            },\n            { \n              "arrayId": "1",\n              "level4ElementString": "level4ElementString" \n            },\n            {\n              "arrayId": "2",\n              "level4ElementObject": {\n                "level5ElObjString": "level5ElObjString"\n              }\n            },\n            ["arrayId:1", 1],\n            ["arrayId:2", 2],\n            ["arrayId:4", {"arrayId":1, "level6Number":1}, {"arrayId":2, "level6Number":2}]\n          ]\n        }\n      }\n    }');return console.log("Testing: level1Object"),0==(t=getNodesByMatchingLabels(globals.nodeList,["level1Object"])).length?t:(console.log("Testing: level2Object"),0==(t=getNodesByMatchingLabels(globals.nodeList,["level2Object"])).length?t:(console.log("Testing: level3Array"),0==(t=getNodesByMatchingLabels(globals.nodeList,["level3Array"])).length?t:(console.log("Testing: level4ElementObject"),0!=(t=getNodesByMatchingLabels(globals.nodeList,["level4ElementObject"])).length||t)))}),globals.allUnitTests.push(function(){var t=(new JsonTranslator).Translate('"TestJsonNode"');return console.log('Testing: "TestJsonNode"'),0!=(t=getNodesByMatchingLabels(globals.nodeList,['"TestJsonNode"'])).length||t}),globals.allUnitTests.push(function(){var t=(new UrlParamsTranslator).Translate("param1--param2");return console.log("Testing: param1"),0==(t=getNodesByMatchingLabels(globals.nodeList,["param1"])).length?t:(console.log("Testing: param2"),0!=(t=getNodesByMatchingLabels(globals.nodeList,["param2"])).length||t)}),globals.allUnitTests.push(function(){var t=(new UrlParamsTranslator).Translate("p1--p2.p2--p3");return console.log("Testing: p1"),0==(t=getNodesByMatchingLabels(globals.nodeList,["p1"])).length?t:(console.log("Testing: p2"),0==(t=getNodesByMatchingLabels(globals.nodeList,["p2"])).length?t:(console.log("Testing: p3"),0!=(t=getNodesByMatchingLabels(globals.nodeList,["p3"])).length||t))}),globals.allUnitTests.push(function(){var t=(new JsonHelper).MergeJson({property1:"test 1"},{property2:"test 2"});return console.log("Merged Json object",t),"test 1"==t.property1&&"test 2"==t.property2||t}),globals.allUnitTests.push(function(){var t=(new JsonHelper).MergeJson({property1:"test 1"},{property1:"test 2"});return console.log("Merged Json object",t),"test 2"==t.property1||t}),globals.allUnitTests.push(function(){var t=(new JsonHelper).MergeJson({level1String:"level1String",level1Object:{level2String:"level2String",level2Object:{level3String:"level3String",level3Array:[{arrayId:"0",level4ElementString:"level4ElementString_BaseObjectOnly"},{arrayId:"1",level4ElementString:"level4ElementString"},{arrayId:"2",level4ElementObject:{level5ElObjString:"level5ElObjString"}},["arrayId:1",1],["arrayId:2",2],["arrayId:4",{arrayId:1,level6Number:1},{arrayId:2,level6Number:2}]]}}},{level1String:"level1String-Replaced",level1Object:{level2String:"level2String-Replaced",level2Object:{level3String:"level3String-Replaced",level3Array:[{arrayId:"3",level4ElementString:"level4ElementString_NewObjectOnly"},{arrayId:"1",level4ElementString:"level4ElementString-Replaced"},{arrayId:"2",level4ElementObject:{level5ElObjString:"level5ElObjString-Replaced"}},["arrayId:3",3],["arrayId:2",4],["arrayId:4",{arrayId:3,level6Number:3},{arrayId:2,level6Number:4}]]}}},"arrayId");return console.log("Merged Json object",t),"level1String-Replaced"===t.level1String&&"level2String-Replaced"===t.level1Object.level2String&&"level3String-Replaced"===t.level1Object.level2Object.level3String&&"0"===t.level1Object.level2Object.level3Array[0].arrayId&&"1"===t.level1Object.level2Object.level3Array[1].arrayId&&"2"===t.level1Object.level2Object.level3Array[2].arrayId&&"3"===t.level1Object.level2Object.level3Array[6].arrayId&&"level4ElementString_BaseObjectOnly"===t.level1Object.level2Object.level3Array[0].level4ElementString&&"level4ElementString-Replaced"===t.level1Object.level2Object.level3Array[1].level4ElementString&&"level5ElObjString-Replaced"===t.level1Object.level2Object.level3Array[2].level4ElementObject.level5ElObjString&&"level4ElementString_NewObjectOnly"===t.level1Object.level2Object.level3Array[6].level4ElementString&&"arrayId:1"===t.level1Object.level2Object.level3Array[3][0]&&1===t.level1Object.level2Object.level3Array[3][1]&&"arrayId:2"===t.level1Object.level2Object.level3Array[4][0]&&2===t.level1Object.level2Object.level3Array[4][1]&&4===t.level1Object.level2Object.level3Array[4][2]&&"arrayId:4"===t.level1Object.level2Object.level3Array[5][0]&&1===t.level1Object.level2Object.level3Array[5][1].arrayId&&1===t.level1Object.level2Object.level3Array[5][1].level6Number&&2===t.level1Object.level2Object.level3Array[5][2].arrayId&&4===t.level1Object.level2Object.level3Array[5][2].level6Number&&3===t.level1Object.level2Object.level3Array[5][3].arrayId&&3===t.level1Object.level2Object.level3Array[5][3].level6Number&&"arrayId:3"===t.level1Object.level2Object.level3Array[7][0]&&3===t.level1Object.level2Object.level3Array[7][1]||t}),globals.allUnitTests.push(function(){var t=(new JsonHelper).GetValueWithPath({property1:"test 1"},"property1");return console.log("Merged Json object",t),"test 1"==t||t}),globals.allUnitTests.push(function(){var t=(new JsonHelper).GetValueWithPath({level1String:"level1String",level1Object:{level2Striing:"level1String",level2Object:{level3String:"level3String"}}},"level1Object/level2Object/level3String");return"level3String"==t||t}),globals.allUnitTests.push(function(){var t=(new JsonHelper).GetValueWithPath({level1String:"level1String",level1Object:{level2Striing:"level1String",level2Object:{level3String:"level3String"}}},"level1Object/falseValue");return void 0==t||t}),globals.allUnitTests.push(function(){var t=(new JsonHelper).GetValueWithPath({level1String:"level1String",level1Object:{level2Striing:"level1String",level2Object:{level3String:"level3String"}}},"level1Object/falsePath/impossibleValue");return void 0==t||t}),globals.allUnitTests.push(function(){var t=(new JsonHelper).GetValueWithPath({level1String:"level1String",level1Object:{level2Striing:"level1String",level2Array:["level3ArrayString"]}},"level1Object/level2Array[0]");return"level3ArrayString"==t||t}),globals.allUnitTests.push(function(){new GraphHelper;var t=new DataService,e=["TypeDefTest"],a={Name:"John",Age:30,Source:"../custom/assets/binoculars.svg"};t.CreateEntity_AddToGraph_ReturnNode(e,a);e=["TypeDefTest"],a={FirstName:"John",Age:"32",Img:"../custom/assets/binoculars.svg"};t.CreateEntity_AddToGraph_ReturnNode(e,a),globals.entityTypeDefs;for(var n=[],o=0;o<globals.entityTypeDefs.length;o++)globals.entityTypeDefs[o].labels[0]==e[0]&&n.push(globals.entityTypeDefs[o]);return console.log("typeDefs",n),1!==n.length?result:"TypeDefTest"!=n[0].labels[0]?result:!!(n[0].properties.Age&&n[0].properties.Img&&n[0].properties.Source&&n[0].properties.Name&&n[0].properties.FirstName)||result});